
/* - formUnload.js - */
// https://tu-dresden.de/portal_javascripts/formUnload.js?original=1
if(!window.beforeunload){(function($){var BeforeUnloadHandler,Class,form,c;BeforeUnloadHandler=function(){var self=this,message;this.message=window.form_modified_message||"Discard changes? If you click OK, any changes you have made will be lost.";this.forms=[];this.chkId=[];this.chkType=new this.CheckType();this.handlers=[this.isAnyFormChanged];this.submitting=false;this.execute=function(event){var domforms=$('form');self.forms=$.grep(self.forms, function(form){return domforms.index(form)>-1});if(self.submitting){return}
$.each(self.handlers, function(i,fn){message=message||fn.apply(self)});if(message===true){message=self.message}
if(message===false){message=undefined}
if(event&&message){event.returnValue=message}
return message};this.execute.tool=this};Class=BeforeUnloadHandler.prototype;Class.isAnyFormChanged=function(){var i;for(i=0;i<this.forms.length;i+=1){form=this.forms[i];if(this.isElementChanged(form)){return true}}
return false};Class.addHandler=function(fn){this.handlers.push(fn)};Class.onsubmit=function(){var tool=window.onbeforeunload&&window.onbeforeunload.tool;tool.submitting=true;plone.UnlockHandler.submitting=true};Class.addForm=function(form){if($.inArray(form,this.forms)>-1){return}
this.forms.push(form);$(form).submit(this.onsubmit);$(form).find('input:hidden').each(function(){var value=this.defaultValue;if(value!==undefined&&value!==null){$(this).attr('originalValue',value.replace(/\r\n?/g,'\n'))}})};Class.addForms=function(){var self=this;$.each(arguments, function(){if(this.tagName.toLowerCase()==='form'){self.addForm(this)} else{self.addForms.apply(self,$(this).find('form').get())}})};Class.removeForms=function(){var self=this;$.each(arguments, function(){if(this.tagName.toLowerCase()==='form'){var formElement=this;self.forms=$.grep(self.forms, function(form){return form!==formElement});$(formElement).unbind('submit',self.onsubmit)} else{self.removeForms.apply(self,$(this).find('form').get())}})};Class.CheckType=function(){};c=Class.CheckType.prototype;c.checkbox=c.radio=function(ele){return ele.checked!==ele.defaultChecked};c.file=c.password=function(ele){return ele.value!==ele.defaultValue};c.text=c.textarea=function(ele){if($(ele).hasClass('mce_editable')&&typeof(tinyMCE)!="undefined"){return tinyMCE.get(ele.id).getContent()!=ele.defaultValue} else if($(ele).hasClass('ckeditor_plone')&&typeof(CKEDITOR)!="undefined"){return CKEDITOR.instances[ele.id].getData()!=ele.defaultValue} else{return ele.value!==ele.defaultValue}};c.hidden=function(ele){var orig=$(ele).attr('originalValue');if(orig===undefined||orig===null){return false}
return $(ele).val().replace(/\r\n?/g,'\n')!==orig};c['select-one']=function(ele){var i,opt;for(i=0;i<ele.length;i+=1){opt=ele[i];if(opt.selected!==opt.defaultSelected){if(i===0&&opt.selected){continue}
return true}}
return false};c['select-multiple']=function(ele){var i,opt;for(i=0;i<ele.length;i+=1){opt=ele[i];if(opt.selected!==opt.defaultSelected){return true}}
return false};Class.chk_form=function(form){var elems=$(form).find('> :input:not(.noUnloadProtection),'+':not(.noUnloadProtection) :input:not(.noUnloadProtection)'),i;for(i=0;i<elems.length;i+=1){if(this.isElementChanged(elems.get(i))){return true}}
return false};Class.isElementChanged=function(ele){var method=ele.id&&this.chkId[ele.id];if(!method&&ele.type&&ele.name){method=this.chkType[ele.type]}
if(!method&&ele.tagName){method=this['chk_'+ele.tagName.toLowerCase()]}
return method?method.call(this,ele):false};window.onbeforeunload=new BeforeUnloadHandler().execute;$(function(){var tool=window.onbeforeunload&&window.onbeforeunload.tool;if(tool&&$('#region-content,#content').length){tool.addForms.apply(tool,$('form.enableUnloadProtection').get())}})}(jQuery))}

