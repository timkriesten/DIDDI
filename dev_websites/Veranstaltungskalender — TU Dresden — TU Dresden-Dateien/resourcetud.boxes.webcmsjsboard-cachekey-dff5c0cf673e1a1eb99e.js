
/* Merged Plone Javascript file
 * This file is dynamically assembled from separate parts.
 * Some of these parts have 3rd party licenses or copyright information attached
 * Such information is valid for that section,
 * not for the entire composite file
 * originating files are separated by - filename.js -
 */

/* - ++resource++tud.boxes.webcms/js/board.js - */
// https://tu-dresden.de/portal_javascripts/++resource++tud.boxes.webcms/js/board.js?original=1
(function($,App){"use strict";App.registerReadyHandler("board", function(){var query,pushState,popped,initialURL,$default_res_container=$('#board-results'),$form_newsboard=$('#board-filter form'),newsboard_url=window.location.href.split('?')[0];$.fn.pullSearchResultsBoard=function(query){return this.each(function(){var $container=$(this);$.get(newsboard_url,query,
function(data){var $ajax_res=$($.parseHTML(data));$form_newsboard.html($ajax_res.find('#board-filter form').children());$container.hide();$container.html($ajax_res.find('#board-results').children());$container.fadeIn();App.trigger("ui");$($container).foundation()})})};pushState=function(query){if(Modernizr.history){var url=newsboard_url+'?'+query;history.pushState(null,null,url)}};popped=(window.history&&'state' in window.history);initialURL=location.href;$(window).bind('popstate', function(event){var initialPop,str;initialPop=!popped&&location.href===initialURL;popped=true;if(initialPop){return}
var query=location.search.split('?')[1]||'';$default_res_container.pullSearchResultsBoard(query)});$form_newsboard.delegate('input, select','change',
function(e){if(this.id=="boardfilter-year"){$('#boardfilter-month').val('0')}
query=$form_newsboard.serialize();$default_res_container.pullSearchResultsBoard(query);pushState(query)});$default_res_container.delegate('.pager a','click', function(e){query=this.search.split('?')[1];$default_res_container.pullSearchResultsBoard(query);$('html, body').animate({scrollTop:$form_newsboard.offset().top},150);pushState(query);e.preventDefault()})})})(jQuery,App);

/* - ++resource++jquery.cookie.js - */
// https://tu-dresden.de/portal_javascripts/++resource++jquery.cookie.js?original=1
jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};

/* - ++resource++jquery.ajaxfileupload.js - */
// https://tu-dresden.de/portal_javascripts/++resource++jquery.ajaxfileupload.js?original=1
(function(){var d=document,w=window;
function get(element){if(typeof element=="string")
element=d.getElementById(element);return element}
function addEvent(el,type,fn){if(w.addEventListener){el.addEventListener(type,fn,false)} else if(w.attachEvent){var f=function(){fn.call(el,w.event)};el.attachEvent('on'+type,f)}}
var toElement=function(){var div=d.createElement('div');return function(html){div.innerHTML=html;var el=div.childNodes[0];div.removeChild(el);return el}}();
function hasClass(ele,cls){return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'))}
function addClass(ele,cls){if(!hasClass(ele,cls)) ele.className+=" "+cls}
function removeClass(ele,cls){var reg=new RegExp('(\\s|^)'+cls+'(\\s|$)');ele.className=ele.className.replace(reg,' ')}
if(document.documentElement["getBoundingClientRect"]){var getOffset=function(el){var box=el.getBoundingClientRect(),doc=el.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,zoom=1;if(body.getBoundingClientRect){var bound=body.getBoundingClientRect();zoom=(bound.right-bound.left)/body.clientWidth}
if(zoom>1){clientTop=0;clientLeft=0}
var top=box.top/zoom+(window.pageYOffset||docElem&&docElem.scrollTop/zoom||body.scrollTop/zoom)-clientTop,left=box.left/zoom+(window.pageXOffset||docElem&&docElem.scrollLeft/zoom||body.scrollLeft/zoom)-clientLeft;return{top:top,left:left}}} else{var getOffset=function(el){if(w.jQuery){return jQuery(el).offset()}
var top=0,left=0;do{top+=el.offsetTop||0;left+=el.offsetLeft||0}
while(el=el.offsetParent);return{left:left,top:top}}}
function getBox(el){var left,right,top,bottom;var offset=getOffset(el);left=offset.left;top=offset.top;right=left+el.offsetWidth;bottom=top+el.offsetHeight;return{left:left,right:right,top:top,bottom:bottom}}
function getMouseCoords(e){if(!e.pageX&&e.clientX){var zoom=1;var body=document.body;if(body.getBoundingClientRect){var bound=body.getBoundingClientRect();zoom=(bound.right-bound.left)/body.clientWidth}
return{x:e.clientX/zoom+d.body.scrollLeft+d.documentElement.scrollLeft,y:e.clientY/zoom+d.body.scrollTop+d.documentElement.scrollTop}}
return{x:e.pageX,y:e.pageY}}
var getUID=function(){var id=0;return function(){return 'ValumsAjaxUpload'+id++}}();
function fileFromPath(file){return file.replace(/.*(\/|\\)/,"")}
function getExt(file){return (/[.]/.exec(file))?/[^.]+$/.exec(file.toLowerCase()):''}
Ajax_upload=AjaxUpload=function(button,options){if(button.jquery){button=button[0]} else if(typeof button=="string"&&/^#.*/.test(button)){button=button.slice(1)}
button=get(button);this._input=null;this._button=button;this._disabled=false;this._submitting=false;this._justClicked=false;this._parentDialog=d.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var parentDialog=jQuery(self._button).parents('.ui-dialog-content');if(parentDialog.length){this._parentDialog=parentDialog[0]}}
this._settings={action:'upload.php',name:'userfile',data:{},autoSubmit:true,responseType:false,onChange: function(file,extension){},onSubmit: function(file,extension){},onComplete: function(file,response){}};for(var i in options){this._settings[i]=options[i]}
this._createInput();this._rerouteClicks()}
AjaxUpload.prototype={setData: function(data){this._settings.data=data},disable: function(){this._disabled=true},enable: function(){this._disabled=false},destroy: function(){if(this._input){if(this._input.parentNode){this._input.parentNode.removeChild(this._input)}
this._input=null}},_createInput: function(){var self=this;var input=d.createElement("input");input.setAttribute('type','file');input.setAttribute('name',this._settings.name);var styles={'position':'absolute','margin':'-5px 0 0 -175px','padding':0,'width':'220px','height':'30px','fontSize':'14px','opacity':0,'cursor':'pointer','display':'none','zIndex':2147483583};for(var i in styles){input.style[i]=styles[i]}
if(!(input.style.opacity==="0")){input.style.filter="alpha(opacity=0)"}
this._parentDialog.appendChild(input);addEvent(input,'change', function(){var file=fileFromPath(this.value);if(self._settings.onChange.call(self,file,getExt(file))==false){return}
if(self._settings.autoSubmit){self.submit()}});addEvent(input,'click', function(){self.justClicked=true;setTimeout(function(){self.justClicked=false},3000)});this._input=input},_rerouteClicks: function(){var self=this;var box,dialogOffset={top:0,left:0},over=false;addEvent(self._button,'mouseover', function(e){if(!self._input||over) return;over=true;box=getBox(self._button);if(self._parentDialog!=d.body){dialogOffset=getOffset(self._parentDialog)}});addEvent(document,'mousemove', function(e){var input=self._input;if(!input||!over) return;if(self._disabled){removeClass(self._button,'hover');input.style.display='none';return}
var c=getMouseCoords(e);if((c.x>=box.left)&&(c.x<=box.right)&&(c.y>=box.top)&&(c.y<=box.bottom)){input.style.top=c.y-dialogOffset.top+'px';input.style.left=c.x-dialogOffset.left+'px';input.style.display='block';addClass(self._button,'hover')} else{over=false;if(!self.justClicked){input.style.display='none'}
removeClass(self._button,'hover')}})},_createIframe: function(){var id=getUID();var iframe=toElement('<iframe src="javascript:false;" name="'+id+'" />');iframe.id=id;iframe.style.display='none';d.body.appendChild(iframe);return iframe},submit: function(){var self=this,settings=this._settings;if(this._input.value===''){return}
var file=fileFromPath(this._input.value);if(!(settings.onSubmit.call(this,file,getExt(file))==false)){var iframe=this._createIframe();var form=this._createForm(iframe);form.appendChild(this._input);form.submit();d.body.removeChild(form);form=null;this._input=null;this._createInput();var toDeleteFlag=false;addEvent(iframe,'load', function(e){if(iframe.src=="about:blank"){if(toDeleteFlag){setTimeout( function(){d.body.removeChild(iframe)},0)}
return}
var doc=iframe.contentDocument?iframe.contentDocument:frames[iframe.id].document;if(doc.readyState&&doc.readyState!='complete'){return}
if(doc.body&&doc.body.innerHTML=="false"){return}
var response;if(doc.XMLDocument){response=doc.XMLDocument} else if(doc.body){response=doc.body.innerHTML;if(settings.responseType=='json'){response=window["eval"]("("+response+")")}} else{var response=doc}
settings.onComplete.call(self,file,response);toDeleteFlag=true;iframe.src="about:blank"})} else{d.body.removeChild(this._input);this._input=null;this._createInput()}},_createForm: function(iframe){var settings=this._settings;var form=toElement('<form method="post" enctype="multipart/form-data"></form>');form.style.display='none';form.action=settings.action;form.target=iframe.name;d.body.appendChild(form);for(var prop in settings.data){var el=d.createElement("input");el.type='hidden';el.name=prop;el.value=settings.data[prop];form.appendChild(el)}
return form}}})();

/* - ++resource++jquery.bbq.js - */
// https://tu-dresden.de/portal_javascripts/++resource++jquery.bbq.js?original=1
(function($,r){var h,n=Array.prototype.slice,t=decodeURIComponent,a=$.param,j,c,m,y,b=$.bbq=$.bbq||{},s,x,k,e=$.event.special,d="hashchange",B="querystring",F="fragment",z="elemUrlAttr",l="href",w="src",p=/^.*\?|#.*$/g,u,H,g,i,C,E={};function G(I){return typeof I==="string"}function D(J){var I=n.call(arguments,1);return function(){return J.apply(this,I.concat(n.call(arguments)))}}function o(I){return I.replace(H,"$2")}function q(I){return I.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function f(K,P,I,L,J){var R,O,N,Q,M;if(L!==h){N=I.match(K?H:/^([^#?]*)\??([^#]*)(#?.*)/);M=N[3]||"";if(J===2&&G(L)){O=L.replace(K?u:p,"")}else{Q=m(N[2]);L=G(L)?m[K?F:B](L):L;O=J===2?L:J===1?$.extend({},L,Q):$.extend({},Q,L);O=j(O);if(K){O=O.replace(g,t)}}R=N[1]+(K?C:O||!N[1]?"?":"")+O+M}else{R=P(I!==h?I:location.href)}return R}a[B]=D(f,0,q);a[F]=c=D(f,1,o);a.sorted=j=function(J,K){var I=[],L={};$.each(a(J,K).split("&"),function(P,M){var O=M.replace(/(?:%5B|=).*$/,""),N=L[O];if(!N){N=L[O]=[];I.push(O)}N.push(M)});return $.map(I.sort(),function(M){return L[M]}).join("&")};c.noEscape=function(J){J=J||"";var I=$.map(J.split(""),encodeURIComponent);g=new RegExp(I.join("|"),"g")};c.noEscape(",/");c.ajaxCrawlable=function(I){if(I!==h){if(I){u=/^.*(?:#!|#)/;H=/^([^#]*)(?:#!|#)?(.*)$/;C="#!"}else{u=/^.*#/;H=/^([^#]*)#?(.*)$/;C="#"}i=!!I}return i};c.ajaxCrawlable(0);$.deparam=m=function(L,I){var K={},J={"true":!0,"false":!1,"null":null};$.each(L.replace(/\+/g," ").split("&"),function(O,T){var N=T.split("="),S=t(N[0]),M,R=K,P=0,U=S.split("]["),Q=U.length-1;if(/\[/.test(U[0])&&/\]$/.test(U[Q])){U[Q]=U[Q].replace(/\]$/,"");U=U.shift().split("[").concat(U);Q=U.length-1}else{Q=0}if(N.length===2){M=t(N[1]);if(I){M=M&&!isNaN(M)?+M:M==="undefined"?h:J[M]!==h?J[M]:M}if(Q){for(;P<=Q;P++){S=U[P]===""?R.length:U[P];R=R[S]=P<Q?R[S]||(U[P+1]&&isNaN(U[P+1])?{}:[]):M}}else{if($.isArray(K[S])){K[S].push(M)}else{if(K[S]!==h){K[S]=[K[S],M]}else{K[S]=M}}}}else{if(S){K[S]=I?h:""}}});return K};function A(K,I,J){if(I===h||typeof I==="boolean"){J=I;I=a[K?F:B]()}else{I=G(I)?I.replace(K?u:p,""):I}return m(I,J)}m[B]=D(A,0);m[F]=y=D(A,1);$[z]||($[z]=function(I){return $.extend(E,I)})({a:l,base:l,iframe:w,img:w,input:w,form:"action",link:l,script:w});k=$[z];function v(L,J,K,I){if(!G(K)&&typeof K!=="object"){I=K;K=J;J=h}return this.each(function(){var O=$(this),M=J||k()[(this.nodeName||"").toLowerCase()]||"",N=M&&O.attr(M)||"";O.attr(M,a[L](N,K,I))})}$.fn[B]=D(v,B);$.fn[F]=D(v,F);b.pushState=s=function(L,I){if(G(L)&&/^#/.test(L)&&I===h){I=2}var K=L!==h,J=c(location.href,K?L:{},K?I:2);location.href=J};b.getState=x=function(I,J){return I===h||typeof I==="boolean"?y(I):y(J)[I]};b.removeState=function(I){var J={};if(I!==h){J=x();$.each($.isArray(I)?I:arguments,function(L,K){delete J[K]})}s(J,2)};e[d]=$.extend(e[d],{add:function(I){var K;function J(M){var L=M[F]=c();M.getState=function(N,O){return N===h||typeof N==="boolean"?m(L,N):m(L,O)[N]};K.apply(this,arguments)}if($.isFunction(I)){K=I;return J}else{K=I.handler;I.handler=J}}})})(jQuery,this);(function($,e,b){var c="hashchange",h=document,f,g=$.event.special,i=h.documentMode,d="on"+c in e&&(i===b||i>7);function a(j){j=j||location.href;return"#"+j.replace(/^[^#]*#?(.*)$/,"$1")}$.fn[c]=function(j){return j?this.bind(c,j):this.trigger(c)};$.fn[c].delay=50;g[c]=$.extend(g[c],{setup:function(){if(d){return false}$(f.start)},teardown:function(){if(d){return false}$(f.stop)}});f=(function(){var j={},p,m=a(),k=function(q){return q},l=k,o=k;j.start=function(){p||n()};j.stop=function(){p&&clearTimeout(p);p=b};function n(){var r=a(),q=o(m);if(r!==m){l(m=r,q);$(e).trigger(c)}else{if(q!==m){location.href=location.href.replace(/#.*/,"")+q}}p=setTimeout(n,$.fn[c].delay)}return j})()})(jQuery,this);

/* - ++resource++jquery.jstree.js - */
// https://tu-dresden.de/portal_javascripts/++resource++jquery.jstree.js?original=1
(function($){$.jstree={datastores:{},plugins:{},defaults:{data:{async:false,type:"html",opts:{method:"GET",url:false}},selected:false,opened:[],languages:[],ui:{dots:true,animation:0,scroll_spd:4,theme_path:false,theme_name:"default",selected_parent_close:"select_parent",selected_delete:"select_previous"},types:{"default":{clickable:true,renameable:true,deletable:true,creatable:true,draggable:true,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:false,position:false}}},rules:{multiple:false,multitree:"none",type_attr:"rel",createat:"bottom",drag_copy:"ctrl",drag_button:"left",use_max_children:true,use_max_depth:true,max_children:-1,max_depth:-1,valid_children:"all"},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange: function(NODE,TREE_OBJ){return true},beforeopen: function(NODE,TREE_OBJ){return true},beforeclose: function(NODE,TREE_OBJ){return true},beforemove: function(NODE,REF_NODE,TYPE,TREE_OBJ){return true},beforecreate: function(NODE,REF_NODE,TYPE,TREE_OBJ){return true},beforerename: function(NODE,LANG,TREE_OBJ){return true},beforedelete: function(NODE,TREE_OBJ){return true},beforedata: function(NODE,TREE_OBJ){return{id:$(NODE).attr("id")||0}},ondata: function(DATA,TREE_OBJ){return DATA},onparse: function(STR,TREE_OBJ){return STR},onhover: function(NODE,TREE_OBJ){},onselect: function(NODE,TREE_OBJ){},ondeselect: function(NODE,TREE_OBJ){},onchange: function(NODE,TREE_OBJ){},onrename: function(NODE,TREE_OBJ,RB){},onmove: function(NODE,REF_NODE,TYPE,TREE_OBJ,RB){},oncopy: function(NODE,REF_NODE,TYPE,TREE_OBJ,RB){},oncreate: function(NODE,REF_NODE,TYPE,TREE_OBJ,RB){},ondelete: function(NODE,TREE_OBJ,RB){},onopen: function(NODE,TREE_OBJ){},onopen_all: function(TREE_OBJ){},onclose_all: function(TREE_OBJ){},onclose: function(NODE,TREE_OBJ){},error: function(TEXT,TREE_OBJ){},ondblclk: function(NODE,TREE_OBJ){TREE_OBJ.toggle_branch.call(TREE_OBJ,NODE);TREE_OBJ.select_branch.call(TREE_OBJ,NODE)},onrgtclk: function(NODE,TREE_OBJ,EV){},onload: function(TREE_OBJ){},oninit: function(TREE_OBJ){},onfocus: function(TREE_OBJ){},ondestroy: function(TREE_OBJ){},onsearch: function(NODES,TREE_OBJ){NODES.addClass("search")},ondrop: function(NODE,REF_NODE,TYPE,TREE_OBJ){},check: function(RULE,NODE,VALUE,TREE_OBJ){return VALUE},check_move: function(NODE,REF_NODE,TYPE,TREE_OBJ){return true}},plugins:{}},create: function(){return new tree_component()},focused: function(){return tree_component.inst[tree_component.focused]},reference: function(obj){var o=$(obj);if(!o.size()) o=$("#"+obj);if(!o.size()) return null;o=(o.is(".tree"))?o.attr("id"):o.parents(".tree:eq(0)").attr("id");return tree_component.inst[o]||null},rollback: function(data){for(var i in data){if(!data.hasOwnProperty(i)) continue;var tmp=tree_component.inst[i];var lock=!tmp.locked;if(lock) tmp.lock(true);tmp.inp=false;tmp.container.html(data[i].html).find(".dragged").removeClass("dragged").end().find(".hover").removeClass("hover");if(data[i].selected){tmp.selected=$("#"+data[i].selected);tmp.selected_arr=[];tmp.container.find("a.clicked").each( function(){tmp.selected_arr.push(tmp.get_node(this))})}
if(lock) tmp.lock(false);delete lock;delete tmp}},drop_mode: function(opts){opts=$.extend(opts,{show:false,type:"default",str:"Foreign node"});tree_component.drag_drop.foreign=true;tree_component.drag_drop.isdown=true;tree_component.drag_drop.moving=true;tree_component.drag_drop.appended=false;tree_component.drag_drop.f_type=opts.type;tree_component.drag_drop.f_data=opts;if(!opts.show){tree_component.drag_drop.drag_help=false;tree_component.drag_drop.drag_node=false}
else{tree_component.drag_drop.drag_help=$("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign'><a href='#'><ins>&nbsp;</ins>"+opts.str+"</a></li></ul></div>");tree_component.drag_drop.drag_node=tree_component.drag_drop.drag_help.find("li:eq(0)")}
if($.jstree.drag_start!==false) $.jstree.drag_start.call(null,false)},drag_start:false,drag:false,drag_end:false};$.fn.jstree=function(opts){return this.each(function(){var conf=$.extend({},opts);if(tree_component.inst&&tree_component.inst[$(this).attr('id')]) tree_component.inst[$(this).attr('id')].destroy();if(conf!==false) new tree_component().init(this,conf)})};
function tree_component(){return{cntr:++tree_component.cntr,settings:$.extend({},$.jstree.defaults),init: function(elem,conf){var _this=this;this.container=$(elem);if(this.container.size==0) return false;tree_component.inst[this.cntr]=this;if(!this.container.attr("id")) this.container.attr("id","jstree_"+this.cntr);tree_component.inst[this.container.attr("id")]=tree_component.inst[this.cntr];tree_component.focused=this.cntr;this.settings=$.extend(true,{},this.settings,conf);if(this.settings.languages&&this.settings.languages.length){this.current_lang=this.settings.languages[0];var st=false;var id="#"+this.container.attr("id");for(var ln=0;ln<this.settings.languages.length;ln++){st=tree_component.add_css(id+" ."+this.settings.languages[ln]);if(st!==false) st.style.display=(this.settings.languages[ln]==this.current_lang)?"":"none"}}
else this.current_lang=false;this.container.addClass("tree");if(this.settings.ui.theme_name!==false){if(this.settings.ui.theme_path===false){$("script").each(function(){if(this.src.toString().match(/jquery\.tree.*?js$/)) { _this.settings.ui.theme_path = this.src.toString().replace(/jquery\.tree.*?js$/,"")+"themes/"+_this.settings.ui.theme_name+"/style.css";return false}})}
if(this.settings.ui.theme_path!=""&&$.inArray(this.settings.ui.theme_path,tree_component.themes)==-1){tree_component.add_sheet({url:this.settings.ui.theme_path});tree_component.themes.push(this.settings.ui.theme_path)}
this.container.addClass("tree-"+this.settings.ui.theme_name)}
var type_icons="";for(var t in this.settings.types){if(!this.settings.types.hasOwnProperty(t)) continue;if(!this.settings.types[t].icon) continue;if(this.settings.types[t].icon.image||this.settings.types[t].icon.position){if(t=="default") type_icons+="#"+this.container.attr("id")+" li > a ins { ";else type_icons+="#"+this.container.attr("id")+" li[rel="+t+"] > a ins { ";if(this.settings.types[t].icon.image) type_icons+=" background-image:url("+this.settings.types[t].icon.image+"); ";if(this.settings.types[t].icon.position) type_icons+=" background-position:"+this.settings.types[t].icon.position+"; ";type_icons+="} "}}
if(type_icons!="") tree_component.add_sheet({str:type_icons});if(this.settings.rules.multiple) this.selected_arr=[];this.offset=false;this.hovered=false;this.locked=false;if(tree_component.drag_drop.marker===false) tree_component.drag_drop.marker=$("<div>").attr({id:"jstree-marker"}).hide().appendTo("body");this.callback("oninit",[this]);this.refresh();this.attach_events();this.focus()},refresh: function(obj){if(this.locked) return this.error("LOCKED");var _this=this;if(obj&&!this.settings.data.async) obj=false;this.is_partial_refresh=obj?true:false;this.opened=Array();if(this.settings.opened!=false){$.each(this.settings.opened, function(i,item){if(this.replace(/^#/,"").length > 0) { _this.opened.push("#" + this.replace(/^#/,""))}});this.settings.opened=false}
else{this.container.find("li.open").each(function(i){if(this.id){_this.opened.push("#"+this.id)}})}
if(this.selected){this.settings.selected=Array();if(obj){$(obj).find("li:has(a.clicked)").each(function(){if(this.id) _this.settings.selected.push("#"+this.id)})}
else{if(this.selected_arr){$.each(this.selected_arr, function(){if(this.attr("id")) _this.settings.selected.push("#"+this.attr("id"))})}
else{if(this.selected.attr("id")) this.settings.selected.push("#"+this.selected.attr("id"))}}}
else if(this.settings.selected!==false){var tmp=Array();if((typeof this.settings.selected).toLowerCase()=="object"){$.each(this.settings.selected, function(){if(this.replace(/^#/,"").length > 0) tmp.push("#" + this.replace(/^#/,""))})}
else{if(this.settings.selected.replace(/^#/,"").length > 0) tmp.push("#" + this.settings.selected.replace(/^#/,""))}
this.settings.selected=tmp}
if(obj&&this.settings.data.async){this.opened=Array();obj=this.get_node(obj);obj.find("li.open").each(function(i){_this.opened.push("#"+this.id)});if(obj.hasClass("open")) obj.removeClass("open").addClass("closed");if(obj.hasClass("leaf")) obj.removeClass("leaf");obj.children("ul:eq(0)").html("");return this.open_branch(obj,true, function(){_this.reselect.apply(_this)})}
var _this=this;var _datastore=new $.jstree.datastores[this.settings.data.type]();if(this.container.children("ul").size()==0){this.container.html("<ul class='ltr' style='direction:ltr;'><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(this.settings.lang.loading||"Loading ...")+"</a></li></ul>")}
_datastore.load(this.callback("beforedata",[false,this]),this,this.settings.data.opts,function(data){data=_this.callback("ondata",[data,_this]);_datastore.parse(data,_this,_this.settings.data.opts,function(str){str=_this.callback("onparse",[str,_this]);_this.container.empty().append($("<ul class='ltr'>").html(str));_this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");_this.container.find("li").not(".open").not(".closed").addClass("leaf");_this.reselect()})})},reselect: function(is_callback){var _this=this;if(!is_callback) this.cl_count=0;else this.cl_count--;if(this.opened&&this.opened.length){var opn=false;for(var j=0;this.opened&&j<this.opened.length;j++){if(this.settings.data.async){var tmp=this.get_node(this.opened[j]);if(tmp.size()&&tmp.hasClass("closed")>0){opn=true;var tmp=this.opened[j].toString().replace('/','\\/');delete this.opened[j];this.open_branch(tmp,true, function(){_this.reselect.apply(_this,[true])});this.cl_count++}}
else this.open_branch(this.opened[j],true)}
if(this.settings.data.async&&opn) return;if(this.cl_count>0) return;delete this.opened}
if(this.cl_count>0) return;this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr");if(this.settings.ui.dots==false) this.container.children("ul:eq(0)").addClass("no_dots");if(this.scrtop){this.container.scrollTop(_this.scrtop);delete this.scrtop}
if(this.settings.selected!==false){$.each(this.settings.selected, function(i){if(_this.is_partial_refresh) _this.select_branch($(_this.settings.selected[i].toString().replace('/','\\/'),_this.container),(_this.settings.rules.multiple!==false));else _this.select_branch($(_this.settings.selected[i].toString().replace('/','\\/'),_this.container),(_this.settings.rules.multiple!==false&&i>0))});this.settings.selected=false}
this.callback("onload",[_this])},get: function(obj,format,opts){if(!format) format=this.settings.data.type;if(!opts) opts=this.settings.data.opts;return new $.tree.datastores[format]().get(obj,this,opts)},attach_events: function(){var _this=this;this.container.bind("mousedown.jstree", function(event){if(tree_component.drag_drop.isdown){tree_component.drag_drop.move_type=false;event.preventDefault();event.stopPropagation();event.stopImmediatePropagation();return false}}).bind("mouseup.jstree", function(event){setTimeout( function(){_this.focus.apply(_this)},5)}).bind("click.jstree", function(event){return true});this.container.on("click",'li', function(event){if(event.target.tagName!="LI") return true;_this.off_height();if(event.pageY-$(event.target).offset().top>_this.li_height) return true;_this.toggle_branch.apply(_this,[event.target]);event.stopPropagation();return false});this.container.on("click.jstree","li a", function(event){if(event.which&&event.which==3) return true;if(_this.locked){event.preventDefault();event.target.blur();return _this.error("LOCKED")}
_this.select_branch.apply(_this,[event.target,event.ctrlKey||_this.settings.rules.multiple=="on"]);if(_this.inp){_this.inp.blur()}
event.preventDefault();event.target.blur();return false}).on("dblclick.jstree","li a", function(event){if(_this.locked){event.preventDefault();event.stopPropagation();event.target.blur();return _this.error("LOCKED")}
_this.callback("ondblclk",[_this.get_node(event.target).get(0),_this]);event.preventDefault();event.stopPropagation();event.target.blur()}).on("contextmenu.jstree","li a", function(event){if(_this.locked){event.target.blur();return _this.error("LOCKED")}
return _this.callback("onrgtclk",[_this.get_node(event.target).get(0),_this,event])}).on("mouseover.jstree","li a", function(event){if(_this.locked){event.preventDefault();event.stopPropagation();return _this.error("LOCKED")}
if(_this.hovered!==false&&(event.target.tagName=="A"||event.target.tagName=="INS")){_this.hovered.children("a").removeClass("hover");_this.hovered=false}
_this.callback("onhover",[_this.get_node(event.target).get(0),_this])}).on("mousedown.jstree","li a", function(event){if(_this.settings.rules.drag_button=="left"&&event.which&&event.which!=1) return true;if(_this.settings.rules.drag_button=="right"&&event.which&&event.which!=3) return true;_this.focus.apply(_this);if(_this.locked) return _this.error("LOCKED");var obj=_this.get_node(event.target);if(_this.settings.rules.multiple!=false&&_this.selected_arr.length>1&&obj.children("a:eq(0)").hasClass("clicked")){var counter=0;for(var i in _this.selected_arr){if(!_this.selected_arr.hasOwnProperty(i)) continue;if(_this.check("draggable",_this.selected_arr[i])){_this.selected_arr[i].addClass("dragged");tree_component.drag_drop.origin_tree=_this;counter++}}
if(counter>0){if(_this.check("draggable",obj)) tree_component.drag_drop.drag_node=obj;else tree_component.drag_drop.drag_node=_this.container.find("li.dragged:eq(0)");tree_component.drag_drop.isdown=true;tree_component.drag_drop.drag_help=$("<div id='jstree-dragged' class='tree "+(_this.settings.ui.theme_name!=""?" tree-"+_this.settings.ui.theme_name:"")+"' />").append("<ul class='"+_this.container.children("ul:eq(0)").get(0).className+"' />");var tmp=tree_component.drag_drop.drag_node.clone();if(_this.settings.languages.length>0) tmp.find("a").not("."+_this.current_lang).hide();tree_component.drag_drop.drag_help.children("ul:eq(0)").append(tmp);tree_component.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("<ins>&nbsp;</ins>Multiple selection").end().children("ul").remove();tree_component.drag_drop.dragged=_this.container.find("li.dragged")}}
else{if(_this.check("draggable",obj)){tree_component.drag_drop.drag_node=obj;tree_component.drag_drop.drag_help=$("<div id='jstree-dragged' class='tree "+(_this.settings.ui.theme_name!=""?" tree-"+_this.settings.ui.theme_name:"")+"' />").append("<ul class='"+_this.container.children("ul:eq(0)").get(0).className+"' />");var tmp=obj.clone();if(_this.settings.languages.length>0) tmp.find("a").not("."+_this.current_lang).hide();tree_component.drag_drop.drag_help.children("ul:eq(0)").append(tmp);tree_component.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last");tree_component.drag_drop.isdown=true;tree_component.drag_drop.foreign=false;tree_component.drag_drop.origin_tree=_this;obj.addClass("dragged");tree_component.drag_drop.dragged=_this.container.find("li.dragged")}}
tree_component.drag_drop.init_x=event.pageX;tree_component.drag_drop.init_y=event.pageY;obj.blur();event.preventDefault();event.stopPropagation();return false})},focus: function(){if(this.locked) return false;if(tree_component.focused!=this.cntr){tree_component.focused=this.cntr;this.callback("onfocus",[this])}},off_height: function(){if(this.offset===false){this.container.css({position:"relative"});this.offset=this.container.offset();var tmp=0;tmp=parseInt($.curCSS(this.container.get(0),"paddingTop",true),10);if(tmp) this.offset.top+=tmp;tmp=parseInt($.curCSS(this.container.get(0),"borderTopWidth",true),10);if(tmp) this.offset.top+=tmp;this.container.css({position:""})}
if(!this.li_height){var tmp=this.container.find("ul li.closed, ul li.leaf").eq(0);this.li_height=tmp.height();if(tmp.children("ul:eq(0)").size()) this.li_height-=tmp.children("ul:eq(0)").height();if(!this.li_height) this.li_height=18}},scroll_check: function(x,y){var _this=this;var cnt=_this.container;var off=_this.container.offset();var st=cnt.scrollTop();var sl=cnt.scrollLeft();var h_cor=(cnt.get(0).scrollWidth>cnt.width())?40:20;if(y-off.top<20) cnt.scrollTop(Math.max((st-_this.settings.ui.scroll_spd),0));if(cnt.height()-(y-off.top)<h_cor) cnt.scrollTop(st+_this.settings.ui.scroll_spd);if(x-off.left<20) cnt.scrollLeft(Math.max((sl-_this.settings.ui.scroll_spd),0));if(cnt.width()-(x-off.left)<40) cnt.scrollLeft(sl+_this.settings.ui.scroll_spd);if(cnt.scrollLeft()!=sl||cnt.scrollTop()!=st){tree_component.drag_drop.move_type=false;tree_component.drag_drop.ref_node=false;tree_component.drag_drop.marker.hide()}
tree_component.drag_drop.scroll_time=setTimeout( function(){_this.scroll_check(x,y)},50)},scroll_into_view: function(obj){obj=obj?this.get_node(obj):this.selected;if(!obj) return false;var off_t=obj.offset().top;var beg_t=this.container.offset().top;var end_t=beg_t+this.container.height();var h_cor=(this.container.get(0).scrollWidth>this.container.width())?40:20;if(off_t+5<beg_t) this.container.scrollTop(this.container.scrollTop()-(beg_t-off_t+5));if(off_t+h_cor>end_t) this.container.scrollTop(this.container.scrollTop()+(off_t+h_cor-end_t))},get_node: function(obj){return $(obj).closest("li")},get_type: function(obj){obj=!obj?this.selected:this.get_node(obj);if(!obj) return;var tmp=obj.attr(this.settings.rules.type_attr);return tmp||"default"},set_type: function(str,obj){obj=!obj?this.selected:this.get_node(obj);if(!obj||!str) return;obj.attr(this.settings.rules.type_attr,str)},get_text: function(obj,lang){obj=this.get_node(obj);if(!obj||obj.size()==0) return "";if(this.settings.languages&&this.settings.languages.length){lang=lang?lang:this.current_lang;obj=obj.children("a."+lang)}
else obj=obj.children("a:visible");var val="";obj.contents().each(function(){if(this.nodeType==3){val=this.data;return false}});return val},check: function(rule,obj){if(this.locked) return false;var v=false;if(obj===-1){if(typeof this.settings.rules[rule]!="undefined") v=this.settings.rules[rule]}
else{obj=!obj?this.selected:this.get_node(obj);if(!obj) return;var t=this.get_type(obj);if(typeof this.settings.types[t]!="undefined"&&typeof this.settings.types[t][rule]!="undefined") v=this.settings.types[t][rule];else if(typeof this.settings.types["default"]!="undefined"&&typeof this.settings.types["default"][rule]!="undefined") v=this.settings.types["default"][rule]}
if(typeof v=="function") v=v.call(null,obj,this);v=this.callback("check",[rule,obj,v,this]);return v},check_move: function(nod,ref_node,how){if(this.locked) return false;if($(ref_node).closest("li.dragged").size()) return false;var tree1=nod.parents(".tree:eq(0)").get(0);var tree2=ref_node.parents(".tree:eq(0)").get(0);if(tree1&&tree1!=tree2){var m=$.jstree.reference(tree2.id).settings.rules.multitree;if(m=="none"||($.isArray(m)&&$.inArray(tree1.id,m)==-1)) return false}
var p=(how!="inside")?this.parent(ref_node):this.get_node(ref_node);nod=this.get_node(nod);if(p==false) return false;var r={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",p):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",p):-1,valid_children:this.check("valid_children",p)};var nod_type=(typeof nod=="string")?nod:this.get_type(nod);if(typeof r.valid_children!="undefined"&&(r.valid_children=="none"||(typeof r.valid_children=="object"&&$.inArray(nod_type,$.makeArray(r.valid_children))==-1))) return false;if(this.settings.rules.use_max_children){if(typeof r.max_children!="undefined"&&r.max_children!=-1){if(r.max_children==0) return false;var c_count=1;if(tree_component.drag_drop.moving==true&&tree_component.drag_drop.foreign==false){c_count=tree_component.drag_drop.dragged.size();c_count=c_count-p.find('> ul > li.dragged').size()}
if(r.max_children<p.find('> ul > li').size()+c_count) return false}}
if(this.settings.rules.use_max_depth){if(typeof r.max_depth!="undefined"&&r.max_depth===0) return this.error("MOVE: MAX-DEPTH REACHED");var mx=(r.max_depth>0)?r.max_depth:false;var i=0;var t=p;while(t!==-1){t=this.parent(t);i++;var m=this.check("max_depth",t);if(m>=0){mx=(mx===false)?(m-i):Math.min(mx,m-i)}
if(mx!==false&&mx<=0) return this.error("MOVE: MAX-DEPTH REACHED")}
if(mx!==false&&mx<=0) return this.error("MOVE: MAX-DEPTH REACHED");if(mx!==false){var incr=1;if(typeof nod!="string"){var t=nod;while(t.size()>0){if(mx-incr<0) return this.error("MOVE: MAX-DEPTH REACHED");t=t.children("ul").children("li");incr++}}}}
if(this.callback("check_move",[nod,ref_node,how,this])==false) return false;return true},hover_branch: function(obj){if(this.locked) return this.error("LOCKED");var _this=this;var obj=_this.get_node(obj);if(!obj.size()) return this.error("HOVER: NOT A VALID NODE");if(!_this.check("clickable",obj)) return this.error("SELECT: NODE NOT SELECTABLE");if(this.hovered) this.hovered.children("A").removeClass("hover");this.hovered=obj;this.hovered.children("a").addClass("hover");this.scroll_into_view(this.hovered)},select_branch: function(obj,multiple){if(this.locked) return this.error("LOCKED");if(!obj&&this.hovered!==false) obj=this.hovered;var _this=this;obj=_this.get_node(obj);if(!obj.size()) return this.error("SELECT: NOT A VALID NODE");obj.children("a").removeClass("hover");if(!_this.check("clickable",obj)) return this.error("SELECT: NODE NOT SELECTABLE");if(_this.callback("beforechange",[obj.get(0),_this])===false) return this.error("SELECT: STOPPED BY USER");if(this.settings.rules.multiple!=false&&multiple&&obj.children("a.clicked").size()>0){return this.deselect_branch(obj)}
if(this.settings.rules.multiple!=false&&multiple){this.selected_arr.push(obj)}
if(this.settings.rules.multiple!=false&&!multiple){for(var i in this.selected_arr){if(!this.selected_arr.hasOwnProperty(i)) continue;this.selected_arr[i].children("A").removeClass("clicked");this.callback("ondeselect",[this.selected_arr[i].get(0),_this])}
this.selected_arr=[];this.selected_arr.push(obj);if(this.selected&&this.selected.children("A").hasClass("clicked")){this.selected.children("A").removeClass("clicked");this.callback("ondeselect",[this.selected.get(0),_this])}}
if(!this.settings.rules.multiple){if(this.selected){this.selected.children("A").removeClass("clicked");this.callback("ondeselect",[this.selected.get(0),_this])}}
this.selected=obj;if(this.hovered!==false){this.hovered.children("A").removeClass("hover");this.hovered=obj}
this.selected.children("a").addClass("clicked").end().parents("li.closed").each( function(){_this.open_branch(this,true)});this.scroll_into_view(this.selected);this.callback("onselect",[this.selected.get(0),_this]);this.callback("onchange",[this.selected.get(0),_this])},deselect_branch: function(obj){if(this.locked) return this.error("LOCKED");var _this=this;var obj=this.get_node(obj);if(obj.children("a.clicked").size()==0) return this.error("DESELECT: NODE NOT SELECTED");obj.children("a").removeClass("clicked");this.callback("ondeselect",[obj.get(0),_this]);if(this.settings.rules.multiple!=false&&this.selected_arr.length>1){this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){_this.selected_arr.push($(this))});if(obj.get(0)==this.selected.get(0)){this.selected=this.selected_arr[0]}}
else{if(this.settings.rules.multiple!=false) this.selected_arr=[];this.selected=false}
this.callback("onchange",[obj.get(0),_this])},toggle_branch: function(obj){if(this.locked) return this.error("LOCKED");var obj=this.get_node(obj);if(obj.hasClass("closed")) return this.open_branch(obj);if(obj.hasClass("open")) return this.close_branch(obj)},open_branch: function(obj,disable_animation,callback){var _this=this;if(this.locked) return this.error("LOCKED");var obj=this.get_node(obj);if(!obj.size()) return this.error("OPEN: NO SUCH NODE");if(obj.hasClass("leaf")) return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&obj.find("li").size()==0){if(this.callback("beforeopen",[obj.get(0),this])===false) return this.error("OPEN: STOPPED BY USER");obj.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(_this.settings.lang.loading||"Loading ...")+"</a></li></ul>");obj.removeClass("closed").addClass("open");var _datastore=new $.jstree.datastores[this.settings.data.type]();_datastore.load(this.callback("beforedata",[obj,this]),this,this.settings.data.opts,function(data){data=_this.callback("ondata",[data,_this]);if(!data||data.length==0){obj.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();if(callback) callback.call();return}
_datastore.parse(data,_this,_this.settings.data.opts,function(str){str=_this.callback("onparse",[str,_this]);obj.children("ul:eq(0)").replaceWith($("<ul>").html(str));obj.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");obj.find("li").not(".open").not(".closed").addClass("leaf");_this.open_branch.apply(_this,[obj]);if(callback) callback.call()})});return true}
else{if(!this.settings.data.async){if(this.callback("beforeopen",[obj.get(0),this])===false) return this.error("OPEN: STOPPED BY USER")}
if(parseInt(this.settings.ui.animation)>0&&!disable_animation){obj.children("ul:eq(0)").css("display","none");obj.removeClass("closed").addClass("open");obj.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation), function(){$(this).css("display","");if(callback) callback.call()})} else{obj.removeClass("closed").addClass("open");if(callback) callback.call()}
this.callback("onopen",[obj.get(0),this]);return true}},close_branch: function(obj,disable_animation){if(this.locked) return this.error("LOCKED");var _this=this;var obj=this.get_node(obj);if(!obj.size()) return this.error("CLOSE: NO SUCH NODE");if(_this.callback("beforeclose",[obj.get(0),_this])===false) return this.error("CLOSE: STOPPED BY USER");if(parseInt(this.settings.ui.animation)>0&&!disable_animation&&obj.children("ul:eq(0)").size()==1){obj.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation), function(){if(obj.hasClass("open")) obj.removeClass("open").addClass("closed");$(this).css("display","")})}
else{if(obj.hasClass("open")) obj.removeClass("open").addClass("closed")}
if(this.selected&&this.settings.ui.selected_parent_close!==false&&obj.children("ul:eq(0)").find("a.clicked").size()>0){obj.find("li:has(a.clicked)").each(function(){_this.deselect_branch(this)});if(this.settings.ui.selected_parent_close=="select_parent"&&obj.children("a.clicked").size()==0) this.select_branch(obj,(this.settings.rules.multiple!=false&&this.selected_arr.length>0))}
this.callback("onclose",[obj.get(0),this])},open_all: function(obj,callback){if(this.locked) return this.error("LOCKED");var _this=this;obj=obj?this.get_node(obj):this.container;var s=obj.find("li.closed").size();if(!callback) this.cl_count=0;else this.cl_count--;if(s>0){this.cl_count+=s;obj.find("li.closed").each( function(){var __this=this;_this.open_branch.apply(_this,[this,true, function(){_this.open_all.apply(_this,[__this,true])}])})}
else if(this.cl_count==0) this.callback("onopen_all",[this])},close_all: function(obj){if(this.locked) return this.error("LOCKED");var _this=this;obj=obj?this.get_node(obj):this.container;obj.find("li.open").each( function(){_this.close_branch(this,true)});this.callback("onclose_all",[this])},set_lang: function(i){if(!$.isArray(this.settings.languages)||this.settings.languages.length==0) return false;if(this.locked) return this.error("LOCKED");if(!$.inArray(i,this.settings.languages)&&typeof this.settings.languages[i]!="undefined") i=this.settings.languages[i];if(typeof i=="undefined") return false;if(i==this.current_lang) return true;var st=false;var id="#"+this.container.attr("id");st=tree_component.get_css(id+" ."+this.current_lang);if(st!==false) st.style.display="none";st=tree_component.get_css(id+" ."+i);if(st!==false) st.style.display="";this.current_lang=i;return true},get_lang: function(){if(!$.isArray(this.settings.languages)||this.settings.languages.length==0) return false;return this.current_lang},create: function(obj,ref_node,position){if(this.locked) return this.error("LOCKED");var root=false;if(ref_node==-1){root=true;ref_node=this.container}
else ref_node=ref_node?this.get_node(ref_node):this.selected;if(!root&&(!ref_node||!ref_node.size())) return this.error("CREATE: NO NODE SELECTED");var pos=position;var tmp=ref_node;if(position=="before"){position=ref_node.parent().children().index(ref_node);ref_node=ref_node.parents("li:eq(0)")}
if(position=="after"){position=ref_node.parent().children().index(ref_node)+1;ref_node=ref_node.parents("li:eq(0)")}
if(!root&&ref_node.size()==0){root=true;ref_node=this.container}
if(!root){if(!this.check("creatable",ref_node)) return this.error("CREATE: CANNOT CREATE IN NODE");if(ref_node.hasClass("closed")){if(this.settings.data.async&&ref_node.children("ul").size()==0){var _this=this;return this.open_branch(ref_node,true, function(){_this.create.apply(_this,[obj,ref_node,position])})}
else this.open_branch(ref_node,true)}}
var torename=false;if(!obj) obj={};else obj=$.extend(true,{},obj);if(!obj.attributes) obj.attributes={};if(!obj.attributes[this.settings.rules.type_attr]) obj.attributes[this.settings.rules.type_attr]=this.get_type(tmp)||"default";if(this.settings.languages.length){if(!obj.data){obj.data={};torename=true}
for(var i=0;i<this.settings.languages.length;i++){if(!obj.data[this.settings.languages[i]]) obj.data[this.settings.languages[i]]=((typeof this.settings.lang.new_node).toLowerCase()!="string"&&this.settings.lang.new_node[i])?this.settings.lang.new_node[i]:this.settings.lang.new_node}}
else{if(!obj.data){obj.data=this.settings.lang.new_node;torename=true}}
obj=this.callback("ondata",[obj,this]);var obj_s=$.jstree.datastores.json().parse(obj,this);obj_s=this.callback("onparse",[obj_s,this]);var $li=$(obj_s);if($li.children("ul").size()){if(!$li.is(".open")) $li.addClass("closed")}
else $li.addClass("leaf");$li.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");$li.find("li").not(".open").not(".closed").addClass("leaf");var r={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",(root?-1:ref_node)):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",(root?-1:ref_node)):-1,valid_children:this.check("valid_children",(root?-1:ref_node))};var nod_type=this.get_type($li);if(typeof r.valid_children!="undefined"&&(r.valid_children=="none"||($.isArray(r.valid_children)&&$.inArray(nod_type,r.valid_children)==-1))) return this.error("CREATE: NODE NOT A VALID CHILD");if(this.settings.rules.use_max_children){if(typeof r.max_children!="undefined"&&r.max_children!=-1&&r.max_children>=this.children(ref_node).size()) return this.error("CREATE: MAX_CHILDREN REACHED")}
if(this.settings.rules.use_max_depth){if(typeof r.max_depth!="undefined"&&r.max_depth===0) return this.error("CREATE: MAX-DEPTH REACHED");var mx=(r.max_depth>0)?r.max_depth:false;var i=0;var t=ref_node;while(t!==-1&&!root){t=this.parent(t);i++;var m=this.check("max_depth",t);if(m>=0){mx=(mx===false)?(m-i):Math.min(mx,m-i)}
if(mx!==false&&mx<=0) return this.error("CREATE: MAX-DEPTH REACHED")}
if(mx!==false&&mx<=0) return this.error("CREATE: MAX-DEPTH REACHED");if(mx!==false){var incr=1;var t=$li;while(t.size()>0){if(mx-incr<0) return this.error("CREATE: MAX-DEPTH REACHED");t=t.children("ul").children("li");incr++}}}
if((typeof position).toLowerCase()=="undefined"||position=="inside")
position=(this.settings.rules.createat=="top")?0:ref_node.children("ul:eq(0)").children("li").size();if(ref_node.children("ul").size()==0||(root==true&&ref_node.children("ul").children("li").size()==0)){if(!root) var a=this.moved($li,ref_node.children("a:eq(0)"),"inside",true);else var a=this.moved($li,this.container.children("ul:eq(0)"),"inside",true)}
else if(pos=="before"&&ref_node.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").size())
var a=this.moved($li,ref_node.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").children("a:eq(0)"),"before",true);else if(pos=="after"&&ref_node.children("ul:eq(0)").children("li:nth-child("+(position)+")").size())
var a=this.moved($li,ref_node.children("ul:eq(0)").children("li:nth-child("+(position)+")").children("a:eq(0)"),"after",true);else if(ref_node.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").size())
var a=this.moved($li,ref_node.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").children("a:eq(0)"),"before",true);else
var a=this.moved($li,ref_node.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",true);if(a===false) return this.error("CREATE: ABORTED");if(torename){this.select_branch($li.children("a:eq(0)"));this.rename()}
return $li},rename: function(obj,new_name){if(this.locked) return this.error("LOCKED");obj=obj?this.get_node(obj):this.selected;var _this=this;if(!obj||!obj.size()) return this.error("RENAME: NO NODE SELECTED");if(!this.check("renameable",obj)) return this.error("RENAME: NODE NOT RENAMABLE");if(!this.callback("beforerename",[obj.get(0),_this.current_lang,_this])) return this.error("RENAME: STOPPED BY USER");obj.parents("li.closed").each(function(){_this.open_branch(this)});if(this.current_lang) obj=obj.find("a."+this.current_lang);else obj=obj.find("a:first");var rb={};rb[this.container.attr("id")]=this.get_rollback();var icn=obj.children("ins").clone();if((typeof new_name).toLowerCase()=="string"){obj.text(new_name).prepend(icn);_this.callback("onrename",[_this.get_node(obj).get(0),_this,rb])}
else{var last_value="";obj.contents().each(function(){if(this.nodeType==3){last_value=this.data;return false}});_this.inp=$("<input type='text' autocomplete='off' />");_this.inp.val(last_value.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown", function(event){event.stopPropagation()}).bind("mouseup", function(event){event.stopPropagation()}).bind("click", function(event){event.stopPropagation()}).bind("keyup", function(event){var key=event.keyCode||event.which;if(key==27){this.value=last_value;this.blur();return}
if(key==13){this.blur();return}});_this.inp.blur(function(event){if(this.value=="") this.value=last_value;obj.text(this.value).prepend(icn);obj.get(0).style.display="";obj.prevAll("span").remove();_this.inp=false;_this.callback("onrename",[_this.get_node(obj).get(0),_this,rb])});var spn=$("<span />").addClass(obj.attr("class")).append(icn).append(_this.inp);obj.get(0).style.display="none";obj.parent().prepend(spn);_this.inp.get(0).focus();_this.inp.get(0).select()}},remove: function(obj){if(this.locked) return this.error("LOCKED");var _this=this;var rb={};rb[this.container.attr("id")]=this.get_rollback();if(obj&&(!this.selected||this.get_node(obj).get(0)!=this.selected.get(0))){obj=this.get_node(obj);if(obj.size()){if(!this.check("deletable",obj)) return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[obj.get(0),_this])) return this.error("DELETE: STOPPED BY USER");$parent=obj.parent();if(obj.find("a.clicked").size()){var reset_selected=false;_this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){if(!reset_selected&&this==_this.selected.get(0)) reset_selected=true;if($(this).parents().index(obj)!=-1) return true;_this.selected_arr.push($(this))});if(reset_selected) this.selected=this.selected_arr[0]||false}
obj=obj.remove();$parent.children("li:last").addClass("last");if($parent.children("li").size()==0){$li=$parent.parents("li:eq(0)");$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()}
this.callback("ondelete",[obj.get(0),this,rb])}}
else if(this.selected){if(!this.check("deletable",this.selected)) return this.error("DELETE: NODE NOT DELETABLE");if(!this.callback("beforedelete",[this.selected.get(0),_this])) return this.error("DELETE: STOPPED BY USER");$parent=this.selected.parent();var obj=this.selected;if(this.settings.rules.multiple==false||this.selected_arr.length==1){var stop=true;var tmp=this.settings.ui.selected_delete=="select_previous"?this.prev(this.selected):false}
obj=obj.remove();$parent.children("li:last").addClass("last");if($parent.children("li").size()==0){$li=$parent.parents("li:eq(0)");$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove()}
if(!stop&&this.settings.rules.multiple!=false){var _this=this;this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){_this.selected_arr.push($(this))});if(this.selected_arr.length>0){this.selected=this.selected_arr[0];this.remove()}}
if(stop&&tmp) this.select_branch(tmp);this.callback("ondelete",[obj.get(0),this,rb])}
else return this.error("DELETE: NO NODE SELECTED")},next: function(obj,strict){obj=this.get_node(obj);if(!obj.size()) return false;if(strict) return(obj.nextAll("li").size()>0)?obj.nextAll("li:eq(0)"):false;if(obj.hasClass("open")) return obj.find("li:eq(0)");else if(obj.nextAll("li").size()>0) return obj.nextAll("li:eq(0)");else return obj.parents("li").next("li").eq(0)},prev: function(obj,strict){obj=this.get_node(obj);if(!obj.size()) return false;if(strict) return(obj.prevAll("li").size()>0)?obj.prevAll("li:eq(0)"):false;if(obj.prev("li").size()){var obj=obj.prev("li").eq(0);while(obj.hasClass("open")) obj=obj.children("ul:eq(0)").children("li:last");return obj}
else return obj.parents("li:eq(0)").size()?obj.parents("li:eq(0)"):false},parent: function(obj){obj=this.get_node(obj);if(!obj.size()) return false;return obj.parents("li:eq(0)").size()?obj.parents("li:eq(0)"):-1},children: function(obj){if(obj===-1) return this.container.children("ul:eq(0)").children("li");obj=this.get_node(obj);if(!obj.size()) return false;return obj.children("ul:eq(0)").children("li")},toggle_dots: function(){if(this.settings.ui.dots){this.settings.ui.dots=false;this.container.children("ul:eq(0)").addClass("no_dots")}
else{this.settings.ui.dots=true;this.container.children("ul:eq(0)").removeClass("no_dots")}},callback: function(cb,args){var p=false;var r=null;for(var i in this.settings.plugins){if(typeof $.jstree.plugins[i]!="object") continue;p=$.jstree.plugins[i];if(p.callbacks&&typeof p.callbacks[cb]=="function") r=p.callbacks[cb].apply(this,args);if(typeof r!=="undefined"&&r!==null){if(cb=="ondata"||cb=="onparse") args[0]=r;else return r}}
p=this.settings.callback[cb];if(typeof p=="function") return p.apply(null,args)},get_rollback: function(){var rb={};rb.html=this.container.html();rb.selected=this.selected?this.selected.attr("id"):false;return rb},moved: function(what,where,how,is_new,is_copy,rb){var what=$(what);var $parent=$(what).parents("ul:eq(0)");var $where=$(where);if($where.is("ins")) $where=$where.parent();if(!rb){var rb={};rb[this.container.attr("id")]=this.get_rollback();if(!is_new){var tmp=what.size()>1?what.eq(0).parents(".tree:eq(0)"):what.parents(".tree:eq(0)");if(tmp.get(0)!=this.container.get(0)){tmp=tree_component.inst[tmp.attr("id")];rb[tmp.container.attr("id")]=tmp.get_rollback()}
delete tmp}}
if(how=="inside"&&this.settings.data.async){var _this=this;if(this.get_node($where).hasClass("closed")){return this.open_branch(this.get_node($where),true, function(){_this.moved.apply(_this,[what,where,how,is_new,is_copy,rb])})}
if(this.get_node($where).find("> ul > li > a.loading").size()==1){setTimeout(function(){_this.moved.apply(_this,[what,where,how,is_new,is_copy])},200);return}}
if(what.size()>1){var _this=this;var tmp=this.moved(what.eq(0),where,how,false,is_copy,rb);what.each(function(i){if(i==0) return;if(tmp){tmp=_this.moved(this,tmp.children("a:eq(0)"),"after",false,is_copy,rb)}});return what}
if(is_copy){_what=what.clone();_what.each(function(i){this.id=this.id+"_copy";$(this).find("li").each(function(){this.id=this.id+"_copy"});$(this).removeClass("dragged").find("a.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged")})}
else _what=what;if(is_new){if(!this.callback("beforecreate",[this.get_node(what).get(0),this.get_node(where).get(0),how,this])) return false}
else{if(!this.callback("beforemove",[this.get_node(what).get(0),this.get_node(where).get(0),how,this])) return false}
if(!is_new){var tmp=what.parents(".tree:eq(0)");if(tmp.get(0)!=this.container.get(0)){tmp=tree_component.inst[tmp.attr("id")];if(tmp.settings.languages.length){var res=[];if(this.settings.languages.length==0) res.push("."+tmp.current_lang);else{for(var i in this.settings.languages){if(!this.settings.languages.hasOwnProperty(i)) continue;for(var j in tmp.settings.languages){if(!tmp.settings.languages.hasOwnProperty(j)) continue;if(this.settings.languages[i]==tmp.settings.languages[j]) res.push("."+this.settings.languages[i])}}}
if(res.length==0) return this.error("MOVE: NO COMMON LANGUAGES");_what.find("a").not(res.join(",")).remove()}
_what.find("a.clicked").removeClass("clicked")}}
what=_what;switch(how){case "before":$where.parents("ul:eq(0)").children("li.last").removeClass("last");$where.parent().before(what.removeClass("last"));$where.parents("ul:eq(0)").children("li:last").addClass("last");break;case "after":$where.parents("ul:eq(0)").children("li.last").removeClass("last");$where.parent().after(what.removeClass("last"));$where.parents("ul:eq(0)").children("li:last").addClass("last");break;case "inside":if($where.parent().children("ul:first").size()){if(this.settings.rules.createat=="top"){$where.parent().children("ul:first").prepend(what.removeClass("last")).children("li:last").addClass("last");var tmp_node=$where.parent().children("ul:first").children("li:first");if(tmp_node.size()){how="before";where=tmp_node}}
else{var tmp_node=$where.parent().children("ul:first").children(".last");if(tmp_node.size()){how="after";where=tmp_node}
$where.parent().children("ul:first").children(".last").removeClass("last").end().append(what.removeClass("last")).children("li:last").addClass("last")}}
else{what.addClass("last");$where.parent().removeClass("leaf").append("<ul/>");if(!$where.parent().hasClass("open")) $where.parent().addClass("closed");$where.parent().children("ul:first").prepend(what)}
if($where.parent().hasClass("closed")){this.open_branch($where)}
break;default:break}
if($parent.find("li").size()==0){var $li=$parent.parent();$li.removeClass("open").removeClass("closed").addClass("leaf");if(!$li.is(".tree")) $li.children("ul").remove();$li.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last")}
else{$parent.children("li.last").removeClass("last");$parent.children("li:last").addClass("last")}
if(is_copy) this.callback("oncopy",[this.get_node(what).get(0),this.get_node(where).get(0),how,this,rb]);else if(is_new) this.callback("oncreate",[this.get_node(what).get(0),($where.is("ul")?-1:this.get_node(where).get(0)),how,this,rb]);else this.callback("onmove",[this.get_node(what).get(0),this.get_node(where).get(0),how,this,rb]);return what},error: function(code){this.callback("error",[code,this]);return false},lock: function(state){this.locked=state;if(this.locked) this.container.children("ul:eq(0)").addClass("locked");else this.container.children("ul:eq(0)").removeClass("locked")},cut: function(obj){if(this.locked) return this.error("LOCKED");obj=obj?this.get_node(obj):this.container.find("a.clicked").filter(":first-child").parent();if(!obj||!obj.size()) return this.error("CUT: NO NODE SELECTED");tree_component.cut_copy.copy_nodes=false;tree_component.cut_copy.cut_nodes=obj},copy: function(obj){if(this.locked) return this.error("LOCKED");obj=obj?this.get_node(obj):this.container.find("a.clicked").filter(":first-child").parent();if(!obj||!obj.size()) return this.error("COPY: NO NODE SELECTED");tree_component.cut_copy.copy_nodes=obj;tree_component.cut_copy.cut_nodes=false},paste: function(obj,position){if(this.locked) return this.error("LOCKED");var root=false;if(obj==-1){root=true;obj=this.container}
else obj=obj?this.get_node(obj):this.selected;if(!root&&(!obj||!obj.size())) return this.error("PASTE: NO NODE SELECTED");if(!tree_component.cut_copy.copy_nodes&&!tree_component.cut_copy.cut_nodes) return this.error("PASTE: NOTHING TO DO");var _this=this;var pos=position;if(position=="before"){position=obj.parent().children().index(obj);obj=obj.parents("li:eq(0)")}
else if(position=="after"){position=obj.parent().children().index(obj)+1;obj=obj.parents("li:eq(0)")}
else if((typeof position).toLowerCase()=="undefined"||position=="inside"){position=(this.settings.rules.createat=="top")?0:obj.children("ul:eq(0)").children("li").size()}
if(!root&&obj.size()==0){root=true;obj=this.container}
if(tree_component.cut_copy.copy_nodes&&tree_component.cut_copy.copy_nodes.size()){var ok=true;if(!root&&!this.check_move(tree_component.cut_copy.copy_nodes,obj.children("a:eq(0)"),"inside")) return false;if(obj.children("ul").size()==0||(root==true&&obj.children("ul").children("li").size()==0)){if(!root) var a=this.moved(tree_component.cut_copy.copy_nodes,obj.children("a:eq(0)"),"inside",false,true);else var a=this.moved(tree_component.cut_copy.copy_nodes,this.container.children("ul:eq(0)"),"inside",false,true)}
else if(pos=="before"&&obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").size())
var a=this.moved(tree_component.cut_copy.copy_nodes,obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").children("a:eq(0)"),"before",false,true);else if(pos=="after"&&obj.children("ul:eq(0)").children("li:nth-child("+(position)+")").size())
var a=this.moved(tree_component.cut_copy.copy_nodes,obj.children("ul:eq(0)").children("li:nth-child("+(position)+")").children("a:eq(0)"),"after",false,true);else if(obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").size())
var a=this.moved(tree_component.cut_copy.copy_nodes,obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").children("a:eq(0)"),"before",false,true);else
var a=this.moved(tree_component.cut_copy.copy_nodes,obj.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",false,true);tree_component.cut_copy.copy_nodes=false}
if(tree_component.cut_copy.cut_nodes&&tree_component.cut_copy.cut_nodes.size()){var ok=true;obj.parents().andSelf().each(function(){if(tree_component.cut_copy.cut_nodes.index(this)!=-1){ok=false;return false}});if(!ok) return this.error("Invalid paste");if(!root&&!this.check_move(tree_component.cut_copy.cut_nodes,obj.children("a:eq(0)"),"inside")) return false;if(obj.children("ul").size()==0||(root==true&&obj.children("ul").children("li").size()==0)){if(!root) var a=this.moved(tree_component.cut_copy.cut_nodes,obj.children("a:eq(0)"),"inside");else var a=this.moved(tree_component.cut_copy.cut_nodes,this.container.children("ul:eq(0)"),"inside")}
else if(pos=="before"&&obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").size())
var a=this.moved(tree_component.cut_copy.cut_nodes,obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").children("a:eq(0)"),"before");else if(pos=="after"&&obj.children("ul:eq(0)").children("li:nth-child("+(position)+")").size())
var a=this.moved(tree_component.cut_copy.cut_nodes,obj.children("ul:eq(0)").children("li:nth-child("+(position)+")").children("a:eq(0)"),"after");else if(obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").size())
var a=this.moved(tree_component.cut_copy.cut_nodes,obj.children("ul:eq(0)").children("li:nth-child("+(position+1)+")").children("a:eq(0)"),"before");else
var a=this.moved(tree_component.cut_copy.cut_nodes,obj.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after");tree_component.cut_copy.cut_nodes=false}},search: function(str,func){var _this=this;if(!str||(this.srch&&str!=this.srch)){this.srch="";this.srch_opn=false;this.container.find("a.search").removeClass("search")}
this.srch=str;if(!str) return;if(!func) func="contains";if(this.settings.data.async){if(!this.srch_opn){var dd=$.extend({"search":str},this.callback("beforedata",[false,this]));$.ajax({type:this.settings.data.opts.method,url:this.settings.data.opts.url,data:dd,dataType:"text",success: function(data){_this.srch_opn=$.unique(data.split(","));_this.search.apply(_this,[str,func])}})}
else if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){var opn=false;for(var j=0;j<this.srch_opn.length;j++){if(this.get_node("#"+this.srch_opn[j]).size()>0){opn=true;var tmp="#"+this.srch_opn[j];delete this.srch_opn[j];this.open_branch(tmp,true, function(){_this.search.apply(_this,[str,func])})}}
if(!opn){this.srch_opn=[];_this.search.apply(_this,[str,func])}}}
else{this.srch_opn=false;var selector="a";if(this.settings.languages.length) selector+="."+this.current_lang;this.callback("onsearch",[this.container.find(selector+":"+func+"('"+str+"')"),this])}}
else{var selector="a";if(this.settings.languages.length) selector+="."+this.current_lang;var nn=this.container.find(selector+":"+func+"('"+str+"')");nn.parents("li.closed").each( function(){_this.open_branch(this,true)});this.callback("onsearch",[nn,this])}},add_sheet:tree_component.add_sheet,destroy: function(){this.callback("ondestroy",[this]);this.container.unbind(".jstree");$("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree");this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search");if(this.cntr==tree_component.focused){for(var i in tree_component.inst){if(i!=this.cntr&&i!=this.container.attr("id")){tree_component.inst[i].focus();break}}}
tree_component.inst[this.cntr]=false;tree_component.inst[this.container.attr("id")]=false;delete tree_component.inst[this.cntr];delete tree_component.inst[this.container.attr("id")];tree_component.cntr--}}};tree_component.cntr=0;tree_component.inst={};tree_component.themes=[];tree_component.drag_drop={isdown:false,drag_node:false,drag_help:false,dragged:false,init_x:false,init_y:false,moving:false,origin_tree:false,marker:false,move_type:false,ref_node:false,appended:false,foreign:false,droppable:[],open_time:false,scroll_time:false};tree_component.mouseup=function(event){var tmp=tree_component.drag_drop;if(tmp.open_time) clearTimeout(tmp.open_time);if(tmp.scroll_time) clearTimeout(tmp.scroll_time);if(tmp.moving&&$.jstree.drag_end!==false) $.jstree.drag_end.call(null,event,tmp);if(tmp.foreign===false&&tmp.drag_node&&tmp.drag_node.size()){tmp.drag_help.remove();if(tmp.move_type){var tree1=tree_component.inst[tmp.ref_node.parents(".tree:eq(0)").attr("id")];if(tree1) tree1.moved(tmp.dragged,tmp.ref_node,tmp.move_type,false,(tmp.origin_tree.settings.rules.drag_copy=="on"||(tmp.origin_tree.settings.rules.drag_copy=="ctrl"&&event.ctrlKey)))}
tmp.move_type=false;tmp.ref_node=false}
if(tmp.foreign!==false){if(tmp.drag_help) tmp.drag_help.remove();if(tmp.move_type){var tree1=tree_component.inst[tmp.ref_node.parents(".tree:eq(0)").attr("id")];if(tree1) tree1.callback("ondrop",[tmp.f_data,tree1.get_node(tmp.ref_node).get(0),tmp.move_type,tree1])}
tmp.foreign=false;tmp.move_type=false;tmp.ref_node=false}
if(tree_component.drag_drop.marker) tree_component.drag_drop.marker.hide();if(tmp.dragged&&tmp.dragged.size()) tmp.dragged.removeClass("dragged");tmp.dragged=false;tmp.drag_help=false;tmp.drag_node=false;tmp.f_type=false;tmp.f_data=false;tmp.init_x=false;tmp.init_y=false;tmp.moving=false;tmp.appended=false;tmp.origin_tree=false;if(tmp.isdown){tmp.isdown=false;event.preventDefault();event.stopPropagation();return false}};tree_component.mousemove=function(event){var tmp=tree_component.drag_drop;var is_start=false;if(tmp.isdown){if(!tmp.moving&&Math.abs(tmp.init_x-event.pageX)<5&&Math.abs(tmp.init_y-event.pageY)<5){event.preventDefault();event.stopPropagation();return false}
else{if(!tmp.moving){tree_component.drag_drop.moving=true;is_start=true}}
if(tmp.open_time) clearTimeout(tmp.open_time);if(tmp.drag_help!==false){if(!tmp.appended){if(tmp.foreign!==false) tmp.origin_tree=$.jstree.focused();$("body").append(tmp.drag_help);tmp.w=tmp.drag_help.width();tmp.appended=true}
tmp.drag_help.css({"left":(event.pageX+5),"top":(event.pageY+15)})}
if(is_start&&$.jstree.drag_start!==false) $.jstree.drag_start.call(null,event,tmp);if($.jstree.drag!==false) $.jstree.drag.call(null,event,tmp);if(event.target.tagName=="DIV"&&event.target.id=="jstree-marker") return false;var et=$(event.target);if(et.is("ins")) et=et.parent();var cnt=et.is(".tree")?et:et.parents(".tree:eq(0)");if(cnt.size()==0||!tree_component.inst[cnt.attr("id")]){if(tmp.scroll_time) clearTimeout(tmp.scroll_time);if(tmp.drag_help!==false) tmp.drag_help.find("li:eq(0) ins").addClass("forbidden");tmp.move_type=false;tmp.ref_node=false;tree_component.drag_drop.marker.hide();return false}
var tree2=tree_component.inst[cnt.attr("id")];tree2.off_height();if(tmp.scroll_time) clearTimeout(tmp.scroll_time);tmp.scroll_time=setTimeout( function(){tree2.scroll_check(event.pageX,event.pageY)},50);var mov=false;var st=cnt.scrollTop();if(event.target.tagName=="A"||event.target.tagName=="INS"){if(et.is("#jstree-dragged")) return false;if(tree2.get_node(event.target).hasClass("closed")){tmp.open_time=setTimeout( function(){tree2.open_branch(et)},500)}
var et_off=et.offset();var goTo={x:(et_off.left-1),y:(event.pageY-et_off.top)};var arr=[];if(goTo.y<tree2.li_height/3+1) arr=["before","inside","after"];else if(goTo.y>tree2.li_height*2/3-1) arr=["after","inside","before"];else{if(goTo.y<tree2.li_height/2) arr=["inside","before","after"];else arr=["inside","after","before"]}
var ok=false;var nn=(tmp.foreign==false)?tmp.origin_tree.container.find("li.dragged"):tmp.f_type;$.each(arr, function(i,val){if(tree2.check_move(nn,et,val)){mov=val;ok=true;return false}});if(ok){switch(mov){case "before":goTo.y=et_off.top-2;tree_component.drag_drop.marker.attr("class","marker");break;case "after":goTo.y=et_off.top-2+tree2.li_height;tree_component.drag_drop.marker.attr("class","marker");break;case "inside":goTo.x-=2;goTo.y=et_off.top-2+tree2.li_height/2;tree_component.drag_drop.marker.attr("class","marker_plus");break}
tmp.move_type=mov;tmp.ref_node=$(event.target);if(tmp.drag_help!==false) tmp.drag_help.find(".forbidden").removeClass("forbidden");tree_component.drag_drop.marker.css({"left":goTo.x,"top":goTo.y}).show()}}
if((et.is(".tree")||et.is("ul"))&&et.find("li:eq(0)").size()==0){var et_off=et.offset();tmp.move_type="inside";tmp.ref_node=cnt.children("ul:eq(0)");if(tmp.drag_help!==false) tmp.drag_help.find(".forbidden").removeClass("forbidden");tree_component.drag_drop.marker.attr("class","marker_plus");tree_component.drag_drop.marker.css({"left":(et_off.left+10),"top":et_off.top+15}).show()}
else if((event.target.tagName!="A"&&event.target.tagName!="INS")||!ok){if(tmp.drag_help!==false) tmp.drag_help.find("li:eq(0) ins").addClass("forbidden");tmp.move_type=false;tmp.ref_node=false;tree_component.drag_drop.marker.hide()}
event.preventDefault();event.stopPropagation();return false}
return true};$(function(){$(document).bind("mousemove.jstree",tree_component.mousemove);$(document).bind("mouseup.jstree",tree_component.mouseup)});tree_component.cut_copy={copy_nodes:false,cut_nodes:false};tree_component.css=false;tree_component.get_css=function(rule_name,delete_flag){rule_name=rule_name.toLowerCase();var css_rules=tree_component.css.cssRules||tree_component.css.rules;var j=0;do{if(css_rules.length&&j>css_rules.length+5) return false;if(css_rules[j].selectorText&&css_rules[j].selectorText.toLowerCase()==rule_name){if(delete_flag==true){if(tree_component.css.removeRule) document.styleSheets[i].removeRule(j);if(tree_component.css.deleteRule) document.styleSheets[i].deleteRule(j);return true}
else return css_rules[j]}}
while(css_rules[++j]);return false};tree_component.add_css=function(rule_name){if(tree_component.get_css(rule_name)) return false;(tree_component.css.insertRule)?tree_component.css.insertRule(rule_name+' { }',0):tree_component.css.addRule(rule_name,null,0);return tree_component.get_css(rule_name)};tree_component.remove_css=function(rule_name){return tree_component.get_css(rule_name,true)};tree_component.add_sheet=function(opts){if(opts.str){var tmp=document.createElement("style");tmp.type="text/css";if(tmp.styleSheet) tmp.styleSheet.cssText=opts.str;else tmp.appendChild(document.createTextNode(opts.str));document.getElementsByTagName("head")[0].appendChild(tmp);return tmp.sheet}
if(opts.url){if(document.createStyleSheet){try{document.createStyleSheet(opts.url)} catch(e){}}
else{var newSS=document.createElement('link');newSS.rel='stylesheet';newSS.type='text/css';newSS.media="all";newSS.href=opts.url;document.getElementsByTagName("head")[0].appendChild(newSS);return newSS.styleSheet}}};$(function(){var u=navigator.userAgent.toLowerCase();var v=(u.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,'0'])[1];var css='/* TREE LAYOUT */ .tree ul { margin:0 0 0 5px; padding:0 0 0 0; list-style-type:none; } .tree li { display:block; min-height:18px; line-height:18px; padding:0 0 0 15px; margin:0 0 0 0; /* Background fix */ clear:both; } .tree li ul { display:none; } .tree li a, .tree li span { display:inline-block;line-height:16px;height:16px;color:black;white-space:nowrap;text-decoration:none;padding:1px 4px 1px 4px;margin:0; } .tree li a:focus { outline: none; } .tree li a input, .tree li span input { margin:0;padding:0 0;display:inline-block;height:12px !important;border:1px solid white;background:white;font-size:10px;font-family:Verdana; } .tree li a input:not([class="xxx"]), .tree li span input:not([class="xxx"]) { padding:1px 0; } /* FOR DOTS */ .tree .ltr li.last { float:left; } .tree > ul li.last { overflow:visible; } /* OPEN OR CLOSE */ .tree li.open ul { display:block; } .tree li.closed ul { display:none !important; } /* FOR DRAGGING */ #jstree-dragged { position:absolute; top:-10px; left:-10px; margin:0; padding:0; } #jstree-dragged ul ul ul { display:none; } #jstree-marker { padding:0; margin:0; line-height:5px; font-size:1px; overflow:hidden; height:5px; position:absolute; left:-45px; top:-30px; z-index:1000; background-color:transparent; background-repeat:no-repeat; display:none; } #jstree-marker.marker { width:45px; background-position:-32px top; } #jstree-marker.marker_plus { width:5px; background-position:right top; } /* BACKGROUND DOTS */ .tree li li { overflow:hidden; } .tree > .ltr > li { display:table; } /* ICONS */ .tree ul ins { display:inline-block; text-decoration:none; width:16px; height:16px; } .tree .ltr ins { margin:0 4px 0 0px; } ';if(/msie/.test(u) && !/opera/.test(u)){if(parseInt(v)==6) css+='.tree li { height:18px; zoom:1; } .tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); } .marker { width:45px; background-position:-32px top; } .marker_plus { width:5px; background-position:right top; }';if(parseInt(v)==7) css+='.tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); }'}
if(/opera/.test(u)) css+='.tree > ul > li.last:after { content:"."; display: block; height:1px; clear:both; visibility:hidden; }';if(/mozilla/.test(u) && !/(compatible|webkit)/.test(u)&&v.indexOf("1.8")==0) css+='.tree .ltr li a { display:inline; float:left; } .tree li ul { clear:both; }';tree_component.css=tree_component.add_sheet({str:css})})})(jQuery);(function($){$.extend($.jstree.datastores,{"html": function(){return{get: function(obj,tree,opts){return obj&&$(obj).size()?$('<div>').append(tree.get_node(obj).clone()).html():tree.container.children("ul:eq(0)").html()},parse: function(data,tree,opts,callback){if(callback) callback.call(null,data);return data},load: function(data,tree,opts,callback){if(opts.url){$.ajax({'type':opts.method,'url':opts.url,'data':data,'dataType':"html",'success': function(d,textStatus){callback.call(null,d)},'error': function(xhttp,textStatus,errorThrown){callback.call(null,false);tree.error(errorThrown+" "+textStatus)}})}
else{callback.call(null,opts.static||tree.container.children("ul:eq(0)").html())}}}},"json": function(){return{get: function(obj,tree,opts){var _this=this;if(!obj||$(obj).size()==0) obj=tree.container.children("ul").children("li");else obj=$(obj);if(!opts) opts={};if(!opts.outer_attrib) opts.outer_attrib=["id","rel","class"];if(!opts.inner_attrib) opts.inner_attrib=[];if(obj.size()>1){var arr=[];obj.each(function(){arr.push(_this.get(this,tree,opts))});return arr}
if(obj.size()==0) return [];var json={attributes:{},data:{}};if(obj.hasClass("open")) json.data.state="open";if(obj.hasClass("closed")) json.data.state="closed";for(var i in opts.outer_attrib){if(!opts.outer_attrib.hasOwnProperty(i)) continue;var val=(opts.outer_attrib[i]=="class")?obj.attr(opts.outer_attrib[i]).replace(/(^| )last( |$)/ig," ").replace(/(^| )(leaf|closed|open)( |$)/ig," "):obj.attr(opts.outer_attrib[i]);if(typeof val!="undefined"&&val.toString().replace(" ","").length>0) json.attributes[opts.outer_attrib[i]]=val;delete val}
if(tree.settings.languages.length){for(var i in tree.settings.languages){if(!tree.settings.languages.hasOwnProperty(i)) continue;var a=obj.children("a."+tree.settings.languages[i]);if(opts.force||opts.inner_attrib.length||a.children("ins").get(0).style.backgroundImage.toString().length||a.children("ins").get(0).className.length){json.data[tree.settings.languages[i]]={};json.data[tree.settings.languages[i]].title=tree.get_text(obj,tree.settings.languages[i]);if(a.children("ins").get(0).style.className.length){json.data[tree.settings.languages[i]].icon=a.children("ins").get(0).style.className}
if(a.children("ins").get(0).style.backgroundImage.length){json.data[tree.settings.languages[i]].icon=a.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")}
if(opts.inner_attrib.length){json.data[tree.settings.languages[i]].attributes={};for(var j in opts.inner_attrib){if(!opts.inner_attrib.hasOwnProperty(j)) continue;var val=a.attr(opts.inner_attrib[j]);if(typeof val!="undefined"&&val.toString().replace(" ","").length>0) json.data[tree.settings.languages[i]].attributes[opts.inner_attrib[j]]=val;delete val}}}
else{json.data[tree.settings.languages[i]]=tree.get_text(obj,tree.settings.languages[i])}}}
else{var a=obj.children("a");json.data.title=tree.get_text(obj);if(a.children("ins").size()&&a.children("ins").get(0).className.length){json.data.icon=a.children("ins").get(0).className}
if(a.children("ins").size()&&a.children("ins").get(0).style.backgroundImage.length){json.data.icon=a.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")}
if(opts.inner_attrib.length){json.data.attributes={};for(var j in opts.inner_attrib){if(!opts.inner_attrib.hasOwnProperty(j)) continue;var val=a.attr(opts.inner_attrib[j]);if(typeof val!="undefined"&&val.toString().replace(" ","").length>0) json.data.attributes[opts.inner_attrib[j]]=val;delete val}}}
if(obj.children("ul").size()>0){json.children=[];obj.children("ul").children("li").each(function(){json.children.push(_this.get(this,tree,opts))})}
return json},parse: function(data,tree,opts,callback){if(Object.prototype.toString.apply(data)==="[object Array]"){var str='';for(var i=0;i<data.length;i++){if(typeof data[i]=="function") continue;str+=this.parse(data[i],tree,opts)}
if(callback) callback.call(null,str);return str}
if(!data||!data.data){if(callback) callback.call(null,false);return ""}
var str='';str+="<li ";var cls=false;if(data.attributes){for(var i in data.attributes){if(!data.attributes.hasOwnProperty(i)) continue;if(i=="class"){str+=" class='"+data.attributes[i]+" ";if(data.state=="closed"||data.state=="open") str+=" "+data.state+" ";str+="' ";cls=true}
else str+=" "+i+"='"+data.attributes[i]+"' "}}
if(!cls&&(data.state=="closed"||data.state=="open")) str+=" class='"+data.state+"' ";str+=">";if(tree.settings.languages.length){for(var i=0;i<tree.settings.languages.length;i++){var attr={};attr["href"]="";attr["style"]="";attr["class"]=tree.settings.languages[i];if(data.data[tree.settings.languages[i]]&&(typeof data.data[tree.settings.languages[i]].attributes).toLowerCase()!="undefined"){for(var j in data.data[tree.settings.languages[i]].attributes){if(!data.data[tree.settings.languages[i]].attributes.hasOwnProperty(j)) continue;if(j=="style"||j=="class") attr[j]+=" "+data.data[tree.settings.languages[i]].attributes[j];else attr[j]=data.data[tree.settings.languages[i]].attributes[j]}}
str+="<a";for(var j in attr){if(!attr.hasOwnProperty(j)) continue;str+=' '+j+'="'+attr[j]+'" '}
str+=">";if(data.data[tree.settings.languages[i]]&&data.data[tree.settings.languages[i]].icon){str+="<ins "+(data.data[tree.settings.languages[i]].icon.indexOf("/")==-1?" class='"+data.data[tree.settings.languages[i]].icon+"' ":" style='background-image:url(\""+data.data[tree.settings.languages[i]].icon+"\");' ")+">&nbsp;</ins>"}
else str+="<ins>&nbsp;</ins>";str+=((typeof data.data[tree.settings.languages[i]].title).toLowerCase()!="undefined"?data.data[tree.settings.languages[i]].title:data.data[tree.settings.languages[i]])+"</a>"}}
else{var attr={};attr["href"]="";attr["style"]="";attr["class"]="";if((typeof data.data.attributes).toLowerCase()!="undefined"){for(var i in data.data.attributes){if(!data.data.attributes.hasOwnProperty(i)) continue;if(i=="style"||i=="class") attr[i]+=" "+data.data.attributes[i];else attr[i]=data.data.attributes[i]}}
str+="<a";for(var i in attr){if(!attr.hasOwnProperty(i)) continue;str+=' '+i+'="'+attr[i]+'" '}
str+=">";if(data.data.icon){str+="<ins "+(data.data.icon.indexOf("/")==-1?" class='"+data.data.icon+"' ":" style='background-image:url(\""+data.data.icon+"\");' ")+">&nbsp;</ins>"}
else str+="<ins>&nbsp;</ins>";str+=((typeof data.data.title).toLowerCase()!="undefined"?data.data.title:data.data)+"</a>"}
if(data.children&&data.children.length){str+='<ul>';for(var i=0;i<data.children.length;i++){str+=this.parse(data.children[i],tree,opts)}
str+='</ul>'}
str+="</li>";if(callback) callback.call(null,str);return str},load: function(data,tree,opts,callback){if(opts.static){callback.call(null,opts.static)}
else{$.ajax({'type':opts.method,'url':opts.url,'data':data,'dataType':"json",'success': function(d,textStatus){callback.call(null,d)},'error': function(xhttp,textStatus,errorThrown){callback.call(null,false);tree.error(errorThrown+" "+textStatus)}})}}}}})})(jQuery);

/* - ++resource++jquery.select2uislider.js - */
// https://tu-dresden.de/portal_javascripts/++resource++jquery.select2uislider.js?original=1
jQuery.fn.selectToUISlider=function(settings){var selects=jQuery(this);var options=jQuery.extend({labels:3,tooltip:true,tooltipSrc:'text',labelSrc:'value',sliderOptions:null},settings);var handleIds=(function(){var tempArr=[];selects.each(function(){tempArr.push('handle_'+jQuery(this).attr('id'))});return tempArr})();var selectOptions=(function(){var opts=[];selects.eq(0).find('option').each(function(){opts.push({value:jQuery(this).attr('value'),text:jQuery(this).text()})});return opts})();var groups=(function(){if(selects.eq(0).find('optgroup').size()>0){var groupedData=[];selects.eq(0).find('optgroup').each(function(i){groupedData[i]={};groupedData[i].label=jQuery(this).attr('label');groupedData[i].options=[];jQuery(this).find('option').each(function(){groupedData[i].options.push({text:jQuery(this).text(),value:jQuery(this).attr('value')})})});return groupedData}
else{return null}})();
function isArray(obj){return obj.constructor==Array}
function ttText(optIndex){return(options.tooltipSrc=='text')?selectOptions[optIndex].text:selectOptions[optIndex].value}
var sliderOptions={step:1,min:0,orientation:'horizontal',max:selectOptions.length-1,range:selects.length>1,slide: function(e,ui){var thisHandle=jQuery(ui.handle);var textval=ttText(ui.value);thisHandle.attr('aria-valuetext',textval).attr('aria-valuenow',ui.value).find('.ui-slider-tooltip .ttContent').text(textval);var currSelect=jQuery('#'+thisHandle.attr('id').split('handle_')[1]);currSelect.find('option').not(ui.value).prop('selected',false);currSelect.find('option').eq(ui.value).prop('selected',true)},values:(function(){var values=[];selects.each(function(){values.push(jQuery(this).get(0).selectedIndex)});return values})()};options.sliderOptions=(settings)?jQuery.extend(sliderOptions,settings.sliderOptions):sliderOptions;selects.bind('change keyup click', function(){var thisIndex=jQuery(this).get(0).selectedIndex;var thisHandle=jQuery('#handle_'+jQuery(this).attr('id'));var handleIndex=thisHandle.data('handleNum');thisHandle.parents('.ui-slider:eq(0)').slider("values",handleIndex,thisIndex)});var sliderComponent=jQuery('<div></div>');selects.each(function(i){var hidett='';var thisLabel=jQuery('label[for='+jQuery(this).attr('id')+']');var labelText=(thisLabel.size()>0)?'Slider control for '+thisLabel.text()+'':'';var thisLabelId=thisLabel.attr('id')||thisLabel.attr('id','label_'+handleIds[i]).attr('id');if(options.tooltip===false){hidett=' style="display: none;"'}
jQuery('<a '+'href="#" tabindex="0" '+'id="'+handleIds[i]+'" '+'class="ui-slider-handle" '+'role="slider" '+'aria-labelledby="'+thisLabelId+'" '+'aria-valuemin="'+options.sliderOptions.min+'" '+'aria-valuemax="'+options.sliderOptions.max+'" '+'aria-valuenow="'+options.sliderOptions.values[i]+'" '+'aria-valuetext="'+ttText(options.sliderOptions.values[i])+'" '+'><span class="screenReaderContext">'+labelText+'</span>'+'<span class="ui-slider-tooltip ui-widget-content ui-corner-all"'+hidett+'><span class="ttContent"></span>'+'<span class="ui-tooltip-pointer-down ui-widget-content"><span class="ui-tooltip-pointer-down-inner"></span></span>'+'</span></a>').data('handleNum',i).appendTo(sliderComponent)});if(groups){var inc=0;var scale=sliderComponent.append('<dl class="ui-slider-scale ui-helper-reset" role="presentation"></dl>').find('.ui-slider-scale:eq(0)');jQuery(groups).each(function(h){scale.append('<dt style="width: '+(100/groups.length).toFixed(2)+'%'+'; left:'+(h/(groups.length-1) * 100).toFixed(2)+'%'+'"><span>'+this.label+'</span></dt>');var groupOpts=this.options;jQuery(this.options).each(function(i){var style=(inc==selectOptions.length-1||inc===0)?'style="display: none;"':'' ;var labelText=(options.labelSrc=='text')?groupOpts[i].text:groupOpts[i].value;scale.append('<dd style="left:'+leftVal(inc)+'"><span class="ui-slider-label">'+labelText+'</span><span class="ui-slider-tic ui-widget-content"'+style+'></span></dd>');inc++})})}
else{var scale=sliderComponent.append('<ol class="ui-slider-scale ui-helper-reset" role="presentation"></ol>').find('.ui-slider-scale:eq(0)');jQuery(selectOptions).each(function(i){var style=(i==selectOptions.length-1||i===0)?'style="display: none;"':'' ;var labelText=(options.labelSrc=='text')?this.text:this.value;scale.append('<li style="left:'+leftVal(i)+'"><span class="ui-slider-label">'+labelText+'</span><span class="ui-slider-tic ui-widget-content"'+style+'></span></li>')})}
function leftVal(i){return(i/(selectOptions.length-1) * 100).toFixed(2)+'%'}
if(options.labels>1){sliderComponent.find('.ui-slider-scale li:last span.ui-slider-label, .ui-slider-scale dd:last span.ui-slider-label').addClass('ui-slider-label-show')}
var increm=Math.max(1,Math.round(selectOptions.length/options.labels));for(var j=0;j<selectOptions.length;j+=increm){if((selectOptions.length-j)>increm){sliderComponent.find('.ui-slider-scale li:eq('+j+') span.ui-slider-label, .ui-slider-scale dd:eq('+j+') span.ui-slider-label').addClass('ui-slider-label-show')}}
sliderComponent.find('.ui-slider-scale dt').each(function(i){jQuery(this).css({'left':((100/(groups.length))*i).toFixed(2)+'%'})});sliderComponent.insertAfter(jQuery(this).eq(this.length-1)).slider(options.sliderOptions).attr('role','application').find('.ui-slider-label').each(function(){jQuery(this).css('marginLeft',-jQuery(this).width()/2)});sliderComponent.find('.ui-tooltip-pointer-down-inner').each(function(){var bWidth=jQuery('.ui-tooltip-pointer-down-inner').css('borderTopWidth');var bColor=jQuery(this).parents('.ui-slider-tooltip').css('backgroundColor');jQuery(this).css('border-top',bWidth+' solid '+bColor)});var values=sliderComponent.slider('values');if(isArray(values)){jQuery(values).each(function(i){sliderComponent.find('.ui-slider-tooltip .ttContent').eq(i).text(ttText(this))})}
else{sliderComponent.find('.ui-slider-tooltip .ttContent').eq(0).text(ttText(values))}
return this};

/* - ++resource++jquery.tagcloud.js - */
// https://tu-dresden.de/portal_javascripts/++resource++jquery.tagcloud.js?original=1
;(function($){var oSettings;var oUlCss={};var oLiCss={};var fGAng=2.399963;$.tagcloud={id:"TagCloud",version:"0.5.0",defaults:{height:null,type:"cloud",sizemax:20,sizemin:10,colormax:"00F",colormin:"B4D2FF",seed:null,power:.5}};$.fn.extend({tagcloud: function(_settings){oSettings=$.extend({},$.tagcloud.defaults,_settings);if(oSettings.seed===null) oSettings.seed=Math.ceil(Math.random()*45309714203);switch(oSettings.type){case "sphere":case "cloud":oUlCss={position:"relative"};oLiCss={position:"absolute",display:"block"};break;case "list":oUlCss={height:"auto"};oLiCss={position:"static",display:"inline"};break}
Rng.setSeed(oSettings.seed+123456);return this.each(function(i,o){var mUl=$(o);var aLi=mUl.find(">li");var iNumLi=aLi.length;var iUlW=mUl.width();var iUlH=oSettings.height===null?(.004*iUlW*iNumLi):oSettings.height;mUl.css({width:iUlW,height:iUlH,listStyle:"none",margin:0,padding:0});mUl.css(oUlCss);var iValMx=-2147483647;var iValMn=2147483648;var iLastVal=-1;for(var j=0;j<iNumLi;j++){var mLi=$(aLi[j]);var iVal=mLi.attr("value")==-1?iLastVal++:mLi.attr("value");if(iVal>iValMx) iValMx=iVal;if(iVal<iValMn) iValMn=iVal;iLastVal=iVal}
var iValRn=iValMx-iValMn;var aLine=new Array();for(var j=0;j<iNumLi;j++) aLine[j]=j;for(var j,x,k=aLine.length;k;j=parseInt(Rng.rand(0,1000)/1000 * k),x=aLine[--k],aLine[k]=aLine[j],aLine[j]=x);iLastVal=-1;for(var j=0;j<iNumLi;j++){var mLi=$(aLi[j]);var iVal=mLi.attr("value")==-1?iLastVal++:mLi.attr("value");iLastVal=iVal;var fPrt=((iNumLi-j-1)/(iNumLi-1));var fPrt=(iVal-iValMn)/iValRn;var iSzFnt=oSettings.sizemin+fPrt*(oSettings.sizemax-oSettings.sizemin);var sColor=colorRng(oSettings.colormin,oSettings.colormax,fPrt);mLi.css({"fontSize":iSzFnt,position:"absolute",color:"#"+sColor,margin:0,padding:0}).children().css({color:"#"+sColor});var iLiW=mLi.width();var iLiH=mLi.height()
var oCss={};if(oSettings.type!="list"){if(oSettings.type=="cloud"){var iXps=Rng.rand(0,iUlW-iLiW);var iYps=aLine[j]*(iUlH/iNumLi)-iLiH/2} else{var fRds=Math.pow(j/iNumLi,oSettings.power);var fRad=(j+Math.PI/2)*fGAng;var iXps=iUlW/2-iLiW/2+.5*iUlW*fRds*Math.sin(fRad);var iYps=iUlH/2-iLiH/2+.5*iUlH*fRds*Math.cos(fRad)}
oCss.left=iXps;oCss.top=iYps}
for(var prop in oLiCss) oCss[prop]=oLiCss[prop];mLi.css(oCss)}})}});var Rng=new function(){this.seed=23145678901;this.A=48271;this.M=2147483647;this.Q=this.M/this.A;this.R=this.M%this.A;this.oneOverM=1.0/this.M}
Rng.setSeed=function(seed){this.seed=seed}
Rng.next=function(){var hi=this.seed/this.Q;var lo=this.seed%this.Q;var test=this.A*lo-this.R*hi;this.seed=test+(test>0?0:this.M);return(this.seed*this.oneOverM)}
Rng.rand=function(lrn,urn){return Math.floor((urn-lrn+1) * this.next()+lrn)}
function d2h(d){return d.toString(16)}
function h2d(h){return parseInt(h,16)}
function getRGB(s){var b3=s.length==3;var aClr=[];for(var i=0;i<3;i++){var sClr=s.substring(i*(b3?1:2),(i+1)*(b3?1:2));aClr.push(h2d(b3?sClr+sClr:sClr))}
return aClr}
function getHex(a){var s="";for(var i=0;i<3;i++){var c=d2h(a[i]);if(c.length==1) c="0"+c;s+=c}
return s}
function colorRng(mn,mx,prt){var aMin=getRGB(mn);var aMax=getRGB(mx);var aRtr=[];for(var i=0;i<3;i++) aRtr.push(aMin[i]+Math.floor(prt*(aMax[i]-aMin[i])));return getHex(aRtr)}
function trace(o){if(window.console&&window.console.log){if(typeof(o)=="string") window.console.log(o);else for(var prop in o) window.console.log(prop+": "+o[prop])}};$.fn.TagCloud=$.fn.Tagcloud=$.fn.tagcloud})(jQuery);

/* - ++resource++tud.datafilter.base/eea.faceted-navigation.js - */
// https://tu-dresden.de/portal_javascripts/++resource++tud.datafilter.base/eea.faceted-navigation.js?original=1
var Faceted={version:'2.0'};Faceted.Events={};Faceted.Events.INITIALIZE='FACETED-INITIALIZE';Faceted.Events.AJAX_QUERY_START='FACETED-AJAX-QUERY-START';Faceted.Events.AJAX_QUERY_SUCCESS='FACETED-AJAX-QUERY-SUCCESS';Faceted.Events.QUERY_INITIALIZED='FACETED-QUERY-INITIALIZED';Faceted.Events.QUERY_CHANGED='FACETED-QUERY-CHANGED';Faceted.Events.RESET='FACETED-RESET';Faceted.Events.FORM_DO_QUERY='FACETED-FORM-DO-QUERY';Faceted.Events.WINDOW_WIDTH_CHANGED='FACETED-WINDOW-WIDTH-CHANGED';Faceted.Events.WINDOW_HEIGHT_CHANGED='FACETED-WINDOW-HEIGHT-CHANGED';Faceted.Events.AJAX_START='FACETED-AJAX-START';Faceted.Events.AJAX_STOP='FACETED-AJAX-STOP';Faceted.Events.AJAX_ERROR='FACETED-AJAX-ERROR';Faceted.Events.REDRAW='FACETED-REDRAW';Faceted.Events.HASHCHANGE='hashchange.FACETED-HASHCHANGE';Faceted.Events.DO_UPDATE='FACETED-DO_UPDATE';Faceted.Events.CLEANUP_COMPLETED='FACETED-CLEANUP-COMPLETED';Faceted.Events.cleanup=function(){jQuery(Faceted.Events).unbind(Faceted.Events.AJAX_QUERY_START);jQuery(Faceted.Events).unbind(Faceted.Events.AJAX_QUERY_SUCCESS);jQuery(Faceted.Events).unbind(Faceted.Events.QUERY_INITIALIZED);jQuery(Faceted.Events).unbind(Faceted.Events.QUERY_CHANGED);jQuery(Faceted.Events).unbind(Faceted.Events.RESET);jQuery(Faceted.Events).unbind(Faceted.Events.FORM_DO_QUERY);jQuery(Faceted.Events).unbind(Faceted.Events.WINDOW_WIDTH_CHANGED);jQuery(Faceted.Events).unbind(Faceted.Events.WINDOW_HEIGHT_CHANGED);jQuery(Faceted.Events).unbind(Faceted.Events.AJAX_START);jQuery(Faceted.Events).unbind(Faceted.Events.AJAX_STOP);jQuery(Faceted.Events).unbind(Faceted.Events.AJAX_ERROR);jQuery(Faceted.Events).unbind(Faceted.Events.REDRAW);jQuery(Faceted.Events).unbind(Faceted.Events.DO_UPDATE);jQuery(window).unbind(Faceted.Events.HASHCHANGE);jQuery(Faceted.Events).trigger(Faceted.Events.CLEANUP_COMPLETED)};Faceted.Widgets={};Faceted.Query={};Faceted.BASEURL='';Faceted.Options={};Faceted.Options.SHOW_SPINNER=true;Faceted.Options.FADE_SPEED='fast';Faceted.SortedQuery=function(query){if(!query){query=Faceted.Query}
var keys=[];jQuery.each(query, function(key){if(!this||this=='all'){return}
keys.push(key)});keys.sort();var res={};jQuery.each(keys, function(index){res[this]=query[this]});return res};Faceted.Window={initialize: function(){this.width=jQuery(window).width();this.height=jQuery(window).height();var js_window=this;jQuery(window).resize(function(){js_window.width_change();js_window.height_change()});var fullscreen=jQuery('a:has(img#icon-full_screen)');if(fullscreen.length){js_window.toggle_fullscreen(fullscreen)}},width_change: function(){var width=jQuery(window).width();if(width!=this.width){this.width=width;jQuery(Faceted.Events).trigger(Faceted.Events.WINDOW_WIDTH_CHANGED,{width:width})}},height_change: function(){var height=jQuery(window).height();if(height!=this.height){this.height=height;jQuery(Faceted.Events).trigger(Faceted.Events.WINDOW_HEIGHT_CHANGED,{height:height})}},toggle_fullscreen: function(button){button.attr('href','#');button.click(function(evt){var toggleFullScreenMode=window.toggleFullScreenMode;if(toggleFullScreenMode){toggleFullScreenMode();jQuery(Faceted.Events).trigger(Faceted.Events.WINDOW_WIDTH_CHANGED)}
return false})}};Faceted.Form={initialize: function(){this.form=jQuery('#faceted-form');this.area=jQuery('#faceted-results');this.mode=this.form.data('mode')||'view';this.version='';var version=jQuery('#faceted-version',this.form);if(version){this.version=version.text()}
var area=this.area;$(document).ajaxError(function(event,request,settings){jQuery(area).html(''+'<h3>This site encountered an error trying to fulfill your request</h3>'+'<p>'+'If the error persists please contact the site maintainer. '+'Thank you for your patience.'+'</p>');jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_ERROR)});var hashquery=Faceted.URLHandler.get();var has_hash=!jQuery.isEmptyObject(hashquery);if(has_hash){Faceted.Query=hashquery}
if(Faceted.Query.b_start===undefined){Faceted.Query.b_start=0}
if(this.mode==='search'&&!has_hash){return}
jQuery(Faceted.Events).trigger(Faceted.Events.QUERY_INITIALIZED);if(!has_hash){Faceted.URLHandler.set()}else{Faceted.URLHandler.hash_changed()}},initialize_paginator: function(){var context=this;Faceted.b_start_changed=false;jQuery('.pagination a').each(function(i){jQuery(this).click(function(){var href=jQuery(this).attr('href');var regex=new RegExp('b_start\\:int=(\\d+)');var b_start=regex.exec(href)[1];Faceted.b_start_changed=true;context.do_query('b_start',b_start);return false})})},reset: function(evt){Faceted.Query={}},do_query: function(wid,value){if(wid!='b_start'&&!Faceted.b_start_changed){Faceted.Query.b_start=0}
if(!value){value=[]}
if(wid){Faceted.Query[wid]=value}
jQuery(Faceted.Events).trigger(Faceted.Events.FORM_DO_QUERY,{wid:wid});Faceted.URLHandler.set()},do_form_query: function(){var context=this;if(Faceted.Query.b_start===undefined){Faceted.Query.b_start=0}
jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_QUERY_START);context.area.fadeOut('fast', function(){if(Faceted.Options.SHOW_SPINNER){var loading='<div class="faceted_loading"></div>';context.area.html(loading);context.area.fadeIn(Faceted.Options.FADE_SPEED)}
var query=Faceted.SortedQuery();query.b_start=query.b_start[0];if(context.version){query.version=context.version}
jQuery.get(Faceted.BASEURL+'@@faceted_query',query, function(data){context.area.fadeOut('fast', function(){context.area.html(data);context.area.fadeIn(Faceted.Options.FADE_SPEED);jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_QUERY_SUCCESS)})})})},highlight: function(elements,css_class,remove){for(var i=0;i<elements.length;i++){var element=jQuery('#'+elements[i]);if(remove){jQuery(element).removeClass(css_class)}else{jQuery(element).addClass(css_class)}}},raise_error: function(msg,error_area,highlights){var area=jQuery('#'+error_area);msg='<div class="portalMessage">'+msg+'</div>';area.html(msg);this.highlight(highlights,'error')},clear_errors: function(error_area,highlights){var area=jQuery('#'+error_area);area.html('');this.highlight(highlights,'error',true)}};Faceted.URLHandler={initialize: function(){},hash_changed: function(){Faceted.Query=this.get();jQuery(Faceted.Events).trigger(Faceted.Events.QUERY_CHANGED);Faceted.Form.do_form_query()},document_hash: function(){var r=window.location.href;var i=r.indexOf("#");return(i>=0?r.substr(i+1):'')},get: function(){var hash=jQuery.bbq.getState();var query={};var types=["number","boolean","string"];jQuery.each(hash, function(key,value){var value_type=typeof(value);if(jQuery.inArray(value_type,types)!==-1){value=[value]}
query[key]=value});return query},set: function(query){if(!query){query=Faceted.Query}
query=jQuery.param(query,traditional=true);jQuery.bbq.pushState(query,2)}};Faceted.Sections={initialize: function(){var self=this;self.form=jQuery('.faceted-form');self.advanced=jQuery('.faceted-advanced-widgets',self.form);self.buttons=jQuery('.faceted-sections-buttons',self.form);if(!self.advanced.length){self.buttons.remove();return}
self.more=jQuery('.faceted-sections-buttons-more',self.form).show();self.less=jQuery('.faceted-sections-buttons-less',self.form).hide();jQuery('a',self.buttons).click(function(evt){self.toggle(jQuery(this),evt);return false})},toggle: function(element,evt){this.more.toggle();this.less.toggle();this.advanced.toggle('blind');var tags=jQuery('.faceted-tagscloud-widget:visible',this.form);if(tags.length){jQuery(Faceted.Events).trigger(Faceted.Events.WINDOW_WIDTH_CHANGED)}}};Faceted.AjaxLook={initialize: function(){this.slaves=[];this.locked=false;var js_object=this;jQuery(Faceted.Events).bind(Faceted.Events.AJAX_START, function(evt,data){js_object.add(data.wid)});jQuery(Faceted.Events).bind(Faceted.Events.AJAX_STOP, function(evt,data){js_object.remove(data.wid)});jQuery(Faceted.Events).bind(Faceted.Events.AJAX_QUERY_START, function(evt){js_object.add('faceted-results')});jQuery(Faceted.Events).bind(Faceted.Events.AJAX_QUERY_SUCCESS, function(evt){js_object.remove('faceted-results')});jQuery(Faceted.Events).bind(Faceted.Events.AJAX_ERROR, function(evt){jQuery(this.slaves).each(function(index){js_object.remove(js_object.slaves[index])})})},add: function(wid){this.lock();this.slaves.push(wid);var widget=jQuery('#'+wid+'_widget');if(widget.length){widget.addClass('faceted-widget-loading')}},remove: function(wid){if(this.slaves.length){this.slaves=jQuery.map(this.slaves, function(slave,index){if(slave==wid){return null}
return slave})}
var widget=jQuery('#'+wid+'_widget');if(widget.length){widget.removeClass('faceted-widget-loading')}
this.unlock()},lock: function(){if(this.locked){return}
this.locked=true;jQuery.each(Faceted.Widgets, function(key){this.widget.addClass('faceted-widget-locked')});var overlay=jQuery('<div>');overlay.addClass('faceted-lock-overlay');overlay.addClass('ui-widget-overlay');overlay.css('z-index',1001);jQuery('#faceted-form').append(overlay)},unlock: function(){if(this.slaves.length){return}
this.locked=false;jQuery.each(Faceted.Widgets, function(key){this.widget.removeClass('faceted-widget-locked')});jQuery('.faceted-lock-overlay').remove()}};Faceted.Load=function(evt,baseurl){if(baseurl){Faceted.BASEURL=baseurl}
jQuery('.faceted-widget:has(div.faceted-widget-error)').remove();jQuery(Faceted.Events).bind(Faceted.Events.REDRAW, function(){if(jQuery('#faceted-left-column:has(div.faceted-widget)').length){jQuery('#center-content-area').addClass('left-area-js')}else{jQuery('#center-content-area').removeClass('left-area-js')}
if(jQuery('#faceted-right-column:has(div.faceted-widget)').length){jQuery('#center-content-area').addClass('right-area-js')}else{jQuery('#center-content-area').removeClass('right-area-js')}});jQuery(Faceted.Events).trigger(Faceted.Events.REDRAW);jQuery(Faceted.Events).trigger(Faceted.Events.INITIALIZE);jQuery(window).bind(Faceted.Events.HASHCHANGE, function(evt){Faceted.URLHandler.hash_changed()});jQuery(Faceted.Events).bind(Faceted.Events.AJAX_QUERY_SUCCESS, function(evt){Faceted.Form.initialize_paginator()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){Faceted.Form.reset()});Faceted.Window.initialize();Faceted.Sections.initialize();Faceted.AjaxLook.initialize();Faceted.Form.initialize();if(window.Calendar){Calendar.prototype.callCloseHandler=function(){if(this.onClose){this.onClose(this)}
this.hideShowCovered();var wid=this.params.inputField.id;wid=wid.split('_')[2];if(!wid){return false}
var widget=Faceted.Widgets[wid];widget.do_query();return false}}};Faceted.Unload=function(){};Faceted.Cleanup=function(){Faceted.Events.cleanup();Faceted.Widgets={};Faceted.Query={};Faceted.URLHandler.set()};

/* - ++resource++eea.facetednavigation.widgets.text.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.text.view.js?original=1
Faceted.TextWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=this.widget.find('label').html();this.selected=[];this.button=jQuery('input[type=submit]',this.widget);this.input=jQuery('#'+this.wid);let input=this.input;this.value='';if(typeof this.input.data("autocomplete")!=='undefined'){if(typeof this.input.data("service-url")=='undefined'){$.getJSON(input.data("initialize-url"), function(data){input.devbridgeAutocomplete().setOptions({lookup:data,onSelect: function(){$(this).submit()}})})}}
var js_widget=this;var form=this.widget.find('form');form.submit(function(){js_widget.text_change(js_widget.button);return false});this.input.change(function(evt){form.submit()});var value=this.input.val();if(value){this.selected=[this.input];this.value=value;Faceted.Query[this.wid]=[value]}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()})};Faceted.TextWidget.prototype={text_change: function(element,evt){if(this.value===this.input.val()){return}
this.do_query(element);jQuery(element).removeClass("submitting")},do_query: function(element){var value=this.input.val();value=value?[value]:[];if(!element){this.selected=[];this.value='';return Faceted.Form.do_query(this.wid,[])}
this.selected=[this.input];this.value=this.input.val();var where=jQuery('input[type=radio]:checked',this.widget);where=where.length==1?where.val():'all';if(where=='all'){return Faceted.Form.do_query(this.wid,value)}
var current=Faceted.Query[this.wid];current=current?current:[];if(value.length&&!(value[0] in current)){current.push(value[0])}
return Faceted.Form.do_query(this.wid,current)},reset: function(){this.selected=[];this.value='';jQuery('#'+this.wid).val('');this.widget.removeClass("faceted-widget-active")},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset();return}
this.input.val(value);this.selected=[this.input];this.value=this.input.val();this.widget.addClass("faceted-widget-active")},criteria: function(){return [{"widget_title":this.title,"option_title":this.value,"handler":()=>{this.criteria_remove()},"id":this.wid,}]},criteria_remove: function(value){this.input.val('');if(!value){this.selected=[];this.value='';this.do_query();return}
jQuery('#'+this.wid+'_place_current',this.widget).attr('checked',true);var element=jQuery('input[type=text]',this.widget);var current=Faceted.Query[this.wid];var index=jQuery.inArray(value,current);if(index==-1){return}
current.splice(index,1);Faceted.Query[this.wid]=current;this.do_query(element)}};Faceted.initializeTextWidget=function(evt){jQuery('div.faceted-text-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.TextWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeTextWidget)});

/* - ++resource++eea.facetednavigation.widgets.tagscloud.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.tagscloud.view.js?original=1
Faceted.TagsCloudWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.tags=jQuery('li',this.widget);this.faceted_count=this.widget.hasClass('faceted-count');this.selected=[];this.version='';var version=jQuery('#faceted-version');if(version){this.version=version.text()}
this.config={};this.initialize();var selected=jQuery('.faceted-tag-selected',this.widget);if(selected.length){var value=selected.attr('id').replace(this.wid,'');value=value.replace(/_-_/g, ' ').replace(/_--_/g,'/');Faceted.Query[this.wid]=[value];this.synchronize()}
var js_widget=this;this.tags.click(function(evt){js_widget.tag_click(this,evt)});jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()});jQuery(Faceted.Events).bind(Faceted.Events.QUERY_INITIALIZED, function(evt){js_widget.count()});jQuery(Faceted.Events).bind(Faceted.Events.FORM_DO_QUERY, function(evt,data){if(data.wid==js_widget.wid||data.wid=='b_start'){return}
js_widget.count()});jQuery(Faceted.Events).bind(Faceted.Events.WINDOW_WIDTH_CHANGED, function(evt,data){var width=js_widget.widget.width();jQuery('ul',js_widget.widget).width(width-30);js_widget.update()})};Faceted.TagsCloudWidget.prototype={initialize: function(){var cloud=jQuery('#'+this.wid+'-cloud',this.widget).text();cloud=cloud?cloud:'list';var sizemin=jQuery('#'+this.wid+'-sizemin',this.widget).text();sizemin=parseInt(sizemin,10);sizemin=sizemin?sizemin:10;var sizemax=jQuery('#'+this.wid+'-sizemax',this.widget).text();sizemax=parseInt(sizemax,10);sizemax=sizemax?sizemax:20;var colormin=jQuery('#'+this.wid+'-colormin',this.widget).text();var colormax=jQuery('#'+this.wid+'-colormax',this.widget).text();var height=jQuery('#'+this.wid+'-height',this.widget).text();height=parseInt(height,10);height=height?height:200;height=(cloud=='list')?'auto':height;this.config={type:cloud,sizemin:sizemin,sizemax:sizemax,height:height,colormin:colormin,colormax:colormax};this.update()},update: function(){jQuery('#'+this.wid,this.widget).tagcloud(this.config)},tag_click: function(tag,evt){this.do_query(tag)},unselect: function(tag){jQuery(tag).removeClass('faceted-tag-selected');this.selected=[];this.widget.removeClass("faceted-widget-active")},select: function(tag){this.unselect(this.tags);jQuery(tag).addClass('faceted-tag-selected');if(jQuery(tag).attr('id').replace(this.wid,'')!='all'){this.selected=[tag];this.widget.addClass("faceted-widget-active")} else{this.widget.removeClass("faceted-widget-active")}},do_query: function(tag){var value=jQuery(tag).attr('id').replace(this.wid,'');value=value.replace(/_-_/g, ' ').replace(/_--_/g,'/');var selected_value='';if(this.selected.length){selected_value=jQuery(this.selected[0]).attr('id').replace(this.wid,'');selected_value=selected_value.replace(/_-_/g, ' ').replace(/_--_/g,'/')}
if(value==selected_value){this.select(jQuery('#'+this.wid+'all',this.widget));value=[]}else{this.select(tag)}
Faceted.Form.do_query(this.wid,value)},reset: function(){this.select(jQuery('#'+this.wid+'all',this.widget))},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset()}else{value=value[0].replace(/\s/g, '_-_').replace(/\//g,'_--_');var tag=jQuery('#'+this.wid+value,this.widget);if(tag.length){this.select(tag[0])}}},criteria: function(){var html=[];var title=this.criteria_title();var body=this.criteria_body();if(title){html.push(title)}
if(body){html.push(body)}
return html},criteria_title: function(){if(!this.selected.length){return ''}
var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid);link.attr('title','Remove '+this.title+' filters');var widget=this;link.click(function(evt){widget.criteria_remove(this,evt);return false});var html=jQuery('<dt>');html.attr('id','criteria_'+this.wid+'_label');html.append(link);html.append('<span>'+this.title+'</span>');return html},criteria_body: function(){if(!this.selected.length){return ''}
var tag_id=jQuery(this.selected[0]).attr('id');var label=jQuery(this.selected[0]).attr('title');var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+tag_id);link.attr('title','Remove '+label+' filter');var widget=this;link.click(function(evt){widget.criteria_remove(this,evt);return false});var html=jQuery('<dd>');var span=jQuery('<span class="faceted-tagscloud-criterion">');html.attr('id','criteria_'+this.wid+'_entries');span.append(link);jQuery('<span>').text(label).appendTo(span);html.append(span);return html},criteria_remove: function(tag,evt){this.do_query(this.selected[0])},count: function(){var query=Faceted.SortedQuery();query.cid=this.wid;if(this.version){query.version=this.version}
var context=this;jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_START,{wid:context.wid});jQuery.get(Faceted.BASEURL+'@@tagscloud_counter',query, function(data){context.count_update(data);jQuery(Faceted.Events).trigger(Faceted.Events.DO_UPDATE);jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_STOP,{wid:context.wid})})},count_update: function(data){var js_widget=this;var all_id=js_widget.wid+'all';var fieldset=jQuery('fieldset',jQuery(data));js_widget.widget.html(fieldset);var min=10000;jQuery('li',js_widget.widget).each(function(){var tag=jQuery(this);var val=tag.attr('value');val=parseInt(val,10);if(val<min&&val>0){min=val}});var all_tag=jQuery('#'+all_id,js_widget.widget);var all=all_tag.attr('value');all_tag.attr('value',min);js_widget.tags=jQuery('li',this.widget);js_widget.tags.click(function(evt){js_widget.tag_click(this,evt)});if(!js_widget.faceted_count){js_widget.update();return}
js_widget.tags.each(function(){var tag=jQuery(this);var html=tag.text();var value=parseInt(tag.attr('value'),10);if(tag.attr('id')==all_id){value=all}else{value-=1}
html=html.replace(/\s\(\d+\)/,'');html+=' ('+value+')';tag.html(html);tag.unbind();if((tag.attr('value')===1)&&(tag.attr('id')!=all_id)){tag.addClass('faceted-tag-disabled')}else{tag.removeClass('faceted-tag-disabled');tag.click(function(evt){js_widget.tag_click(this,evt)})}});js_widget.update()}};Faceted.initializeTagsCloudWidget=function(evt){jQuery('div.faceted-tagscloud-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.TagsCloudWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeTagsCloudWidget)});

/* - ++resource++eea.facetednavigation.widgets.sorting.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.sorting.view.js?original=1
Faceted.SortingWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+this.wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.reverse=jQuery('#'+this.wid+'_reversed');this.elements=jQuery('option',this.widget);this.selected=[];this.select=jQuery('#'+this.wid);this.translations={'reversed':{'en':'reversed','de':'umgekehrt',}};var error=jQuery('.faceted-widget:has(div.faceted-sorting-errors)');if(error.length){error.remove();jQuery(Faceted.Events).trigger(Faceted.Events.REDRAW);return}
jQuery('form',this.widget).submit(function(){return false});var js_widget=this;this.select.change(function(evt){js_widget.select_change(this,evt)});this.reverse.click(function(evt){js_widget.reverse_change(this,evt)});var value=this.select.val();if(value){this.selected=this.widget.find('option:selected');Faceted.Query[this.wid]=[value];var reverse=this.reverse.prop('checked');if(reverse){Faceted.Query.reversed='on'}}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(){js_widget.reset()})};Faceted.SortingWidget.prototype={select_change: function(element,evt){this.do_query(element)},reverse_change: function(element,evt){this.do_query(element)},do_query: function(element){if(!element){this.selected=[];Faceted.Form.do_query(this.wid,[]);return}
var value=null;if(jQuery(element).attr('type')=='checkbox'){value=element.checked?'on':[];if(!this.selected.length){Faceted.Query.reversed=value;return}
Faceted.Form.do_query('reversed',value);return}else{value=jQuery(element).val();if(!value){this.selected=[];value=[]}else{this.selected=this.widget.find('option:selected')}
Faceted.Form.do_query(this.wid,value);return}},reset: function(reversed){reversed=reversed?true:false;this.select.val("");this.reverse.attr('checked',reversed);this.selected=[];this.widget.removeClass("faceted-widget-active")},synchronize: function(){var value=Faceted.Query[this.wid];var reversed_value=Faceted.Query.reversed;if(!reversed_value){reversed_value=false}
else if(reversed_value.length==1&&!reversed_value[0]){reversed_value=false}
else{reversed_value=true}
if(!value){this.reset(reversed_value);return}
var context=this;jQuery.each(value, function(){var selected=context.widget.find('option:selected');if(!selected.length){context.reset(reversed_value)}else{context.selected=selected;context.select.val(value);context.reverse.attr('checked',reversed_value);context.widget.addClass("faceted-widget-active")}})},criteria: function(){var widget=this;var lang=$("html").attr("lang");return widget.selected.map(function(element,index){var element=jQuery(this);var reversed=widget.reverse.prop('checked');return{"widget_title":widget.title,"option_title":element.text()+(reversed?' ('+widget.translations.reversed[lang]+')':''),"handler":()=>{widget.criteria_remove()},"id":widget.wid,}})},criteria_remove: function(){this.select.val('').trigger('change.select2');this.reverse.attr('checked',false);Faceted.Query.reversed=[];this.do_query()}};Faceted.initializeSortingWidget=function(evt){jQuery('div.faceted-sorting-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.SortingWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeSortingWidget)});

/* - ++resource++eea.facetednavigation.widgets.select.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.select.view.js?original=1
Faceted.SelectWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+this.wid+'_widget');this.widget.show();this.title=this.widget.find('label').html();this.elements=this.widget.find('option');this.select=jQuery('#'+this.wid);this.selected=[];this.version='';var version=jQuery('#faceted-version');if(version){this.version=version.text()}
jQuery('form',this.widget).submit(function(){return false});var js_widget=this;this.select.change(function(evt){js_widget.select_change(this,evt)});var value=this.select.val();if(value){this.selected=js_widget.widget.find('option:selected');Faceted.Query[this.wid]=[value]}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()});if(this.widget.hasClass('faceted-count')){var sortcountable=this.widget.hasClass('faceted-sortcountable');jQuery(Faceted.Events).bind(Faceted.Events.QUERY_INITIALIZED, function(evt){js_widget.count(sortcountable)});jQuery(Faceted.Events).bind(Faceted.Events.FORM_DO_QUERY, function(evt,data){if(data.wid==js_widget.wid||data.wid=='b_start'){return}
js_widget.count(sortcountable)})}};Faceted.SelectWidget.prototype={select_change: function(element,evt){if(!jQuery(element).val()){element=null}
this.do_query(element)},do_query: function(element){if(!element){this.selected=[];return Faceted.Form.do_query(this.wid,[])}else{var value=jQuery(element).val();this.selected=this.widget.find('option:selected');return Faceted.Form.do_query(this.wid,value)}},reset: function(){if(this.widget.hasClass('hide-all-option')){var first_val=this.select.find("option:first").val();this.select.val(first_val).trigger('change.select2');this.selected=[first_val];this.select_change(this.select)}
else{this.select.val("").trigger('change.select2');this.selected=[]}
this.widget.removeClass("faceted-widget-active")},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset();return}
var context=this;jQuery.each(value, function(){var selected=context.widget.find('option[value="'+this+'"]');if(!selected.length){context.reset()}else{context.selected=selected;context.select.val(value).trigger('change.select2');context.widget.addClass("faceted-widget-active")}})},criteria: function(){var widget=this;return widget.selected.map(function(element,index){var element=jQuery(this);return{"widget_title":widget.title,"option_title":element.text(),"handler":()=>{widget.criteria_remove()},"id":widget.wid,}})},criteria_remove: function(){this.select.val('').trigger('change.select2');this.do_query()},count: function(sortcountable){var query=Faceted.SortedQuery();query.cid=this.wid;if(this.version){query.version=this.version}
var context=this;jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_START,{wid:context.wid});jQuery.getJSON(Faceted.BASEURL+'@@faceted_counter',query, function(data){context.count_update(data,sortcountable);jQuery(Faceted.Events).trigger(Faceted.Events.DO_UPDATE);jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_STOP,{wid:context.wid})})},count_update: function(data,sortcountable){var context=this;var select=jQuery('select',context.widget);var options=jQuery('option',context.widget);var current_val=select.val();jQuery(options).each(function(){var option=jQuery(this);option.removeClass('faceted-select-item-disabled');option.attr('disabled',false);var key=option.val();var value=data[key];value=value?value:0;var option_txt=option.attr('title');option_txt+=' ('+value+')';option.html(option_txt);if(sortcountable){option.data('count',value)}
if(!value){option.attr('disabled','disabled');option.addClass('faceted-select-item-disabled')}});if(sortcountable){options.detach().sort(function(x,y){var a=jQuery(x).data('count');var b=jQuery(y).data('count');return b-a});select.append(options);select.val(current_val)}
var select2Instance=select.data('select2');if(select2Instance){var options=select2Instance.options.options;select.select2('destroy').select2(options)}}};Faceted.initializeSelectWidget=function(evt){jQuery('div.faceted-select-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.SelectWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeSelectWidget)});

/* - ++resource++eea.facetednavigation.widgets.resultsperpage.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.resultsperpage.view.js?original=1
Faceted.ResultsPerPageWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+this.wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.elements=jQuery('option',this.widget);this.select=jQuery('#'+this.wid);this.selected=[];jQuery('form',this.widget).submit(function(){return false});var js_widget=this;this.select.change(function(evt){js_widget.select_change(this,evt)});var value=this.select.val();if(value){this.selected=this.widget.find('option:selected');Faceted.Query[this.wid]=[value]}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()})};Faceted.ResultsPerPageWidget.prototype={select_change: function(element,evt){if(!jQuery(element).val()){element=null}
this.do_query(element)},do_query: function(element){if(!element){this.selected=[];return Faceted.Form.do_query(this.wid,[])} else{var value=jQuery(element).val();this.selected=this.widget.find('option:selected');return Faceted.Form.do_query(this.wid,value)}},reset: function(){this.select.val("");this.selected=[];this.widget.removeClass("faceted-widget-active")},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset();return}
var context=this;jQuery.each(value, function(){var selected=context.widget.find('option:selected');if(!selected.length){context.reset()} else{context.selected=selected;context.select.val(value);context.widget.addClass("faceted-widget-active")}})},criteria: function(){var html=[];var title=this.criteria_title();var body=this.criteria_body();if(title){html.push(title)}
if(body){html.push(body)}
return html},criteria_title: function(){if(!this.selected.length){return ''}
var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid);link.attr('title','Remove '+this.title+' filters');var widget=this;link.click(function(evt){widget.criteria_remove();return false});var html=jQuery('<dt>');html.attr('id','criteria_'+this.wid+'_label');html.append(link);html.append('<span>'+this.title+'</span>');return html},criteria_body: function(){if(!this.selected.length){return ''}
var widget=this;var html=jQuery('<dd>');var span=jQuery('<span class="faceted-resultsperpage-criterion">');html.attr('id','criteria_'+this.wid+'_entries');var element=jQuery(this.selected);var value=element.val();var label=element.html();var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid+'_'+value);link.attr('title','Remove '+label+' filter');link.click(function(evt){widget.criteria_remove();return false});span.append(link);jQuery('<span>').text(label).appendTo(span);html.append(span);return html},criteria_remove: function(){this.select.val('');this.do_query()}};Faceted.initializeResultsPerPageWidget=function(evt){jQuery('div.faceted-resultsperpage-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.ResultsPerPageWidget(wid)})};jQuery(document).ready(
function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeResultsPerPageWidget)});

/* - ++resource++eea.facetednavigation.widgets.range.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.range.view.js?original=1
Faceted.RangeWidget=function(wid){var js_widget=this;this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.start=jQuery('input[name=start]',this.widget);this.end=jQuery('input[name=end]',this.widget);this.selected=[];this.invalidRangeMsg=this.widget.data("invalid-range-msg");var start=this.start.val();var end=this.end.val();if(start&&end){this.selected=[this.start,this.end];Faceted.Query[this.wid]=[start,end]}
jQuery('form',this.widget).submit(function(){return false});var handle=function(evt){js_widget.select_change(this,evt)};this.start.change(handle);this.end.change(handle);jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()})};Faceted.RangeWidget.prototype={select_change: function(element){this.do_query(element)},do_query: function(element){var start=this.start.val();start=parseFloat(start)||start;var end=this.end.val();end=parseFloat(end)||end;if(!start||!end){this.selected=[];return false}
var value=[this.start.val(),this.end.val()];if(end<start){Faceted.Form.raise_error(this.invalidRangeMsg,this.wid+'_errors',[])}else{this.selected=[this.start,this.end];Faceted.Form.clear_errors(this.wid+'_errors',[]);Faceted.Form.do_query(this.wid,value)}},reset: function(){this.selected=[];this.widget.removeClass("faceted-widget-active");this.start.val('');this.end.val('')},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset();return false}
if(!value.length){this.reset();return false}
if(value.length<2){this.reset();return false}
var start=value[0];var end=value[1];this.start.val(start);this.end.val(end);this.selected=[this.start,this.end];this.widget.addClass("faceted-widget-active")},criteria: function(){var html=[];var title=this.criteria_title();var body=this.criteria_body();if(title){html.push(title)}
if(body){html.push(body)}
return html},criteria_title: function(){if(!this.selected.length){return ''}
var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid);link.attr('title','Remove '+this.title+' filters');var widget=this;link.click(function(evt){widget.criteria_remove();return false});var html=jQuery('<dt>');html.append(link);html.append('<span>'+this.title+'</span>');return html},criteria_body: function(){if(!this.selected.length){return ''}
var widget=this;var html=jQuery('<dd>');var span=jQuery('<span class="faceted-range-criterion">');var start=this.start.val();var end=this.end.val();var label=start+' - '+end;var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid+'_');link.attr('title','Remove '+label+' filter');link.click(function(evt){widget.criteria_remove();return false});span.append(link);jQuery('<span>').text(label).appendTo(span);html.append(span);return html},criteria_remove: function(){this.reset();return Faceted.Form.do_query(this.wid,[])}};Faceted.initializeRangeWidget=function(evt){jQuery('div.faceted-range-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.RangeWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeRangeWidget)});

/* - ++resource++eea.facetednavigation.widgets.radio.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.radio.view.js?original=1
Faceted.RadioWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.fieldset=jQuery('.widget-fieldset',this.widget);this.title=jQuery('legend',this.widget).html();this.elements=jQuery('input[type=radio]',this.widget);this.maxitems=parseInt(jQuery('span',this.widget).text(),10);this.selected=[];this.version='';var version=jQuery('#faceted-version');if(version){this.version=version.text()}
jQuery('form',this.widget).submit(function(){return false});var js_widget=this;this.elements.click(function(evt){js_widget.radio_click(this,evt)});var selected=jQuery('input[type=radio]:checked',this.widget);if(selected.length&&selected.val()!=""){this.selected=selected;Faceted.Query[this.wid]=[this.selected.val()]}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(){js_widget.reset()});if(this.widget.hasClass('faceted-count')){var sortcountable=this.widget.hasClass('faceted-sortcountable');jQuery(Faceted.Events).bind(Faceted.Events.QUERY_INITIALIZED, function(evt){js_widget.count(sortcountable)});jQuery(Faceted.Events).bind(Faceted.Events.FORM_DO_QUERY, function(evt,data){if(data.wid==js_widget.wid||data.wid=='b_start'){return}
js_widget.count(sortcountable)})}
if(this.maxitems){this.fieldset.collapsible({maxitems:this.maxitems,elements:'li:not(.faceted-radio-item-zerocount)',more:this.widget.data("more"),less:this.widget.data("less")})}};Faceted.RadioWidget.prototype={radio_click: function(element,evt){if(!jQuery(element).val()){element=null}
this.do_query(element)},do_query: function(element){if(!element){this.selected=[];return Faceted.Form.do_query(this.wid,[])}else{this.selected=[element];var value=jQuery(this.selected[0]).val();return Faceted.Form.do_query(this.wid,value)}},reset: function(){jQuery(this.elements[0]).prop('checked',true);this.selected=[];this.widget.removeClass("faceted-widget-active")},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset();return}
var context=this;if(typeof value!='object'){value=[value]}
jQuery.each(value, function(){var radio=jQuery('#'+context.wid+'_widget input[type=radio][value="'+this+'"]');if(!radio.length){context.reset()}else{context.selected=radio;context.selected.prop('checked',true);context.widget.addClass("faceted-widget-active")}})},criteria: function(){var widget=this;return widget.selected.map(function(element,index){var element=jQuery(this);return{"widget_title":widget.title,"option_title":element.next().attr("title"),"handler":()=>{widget.criteria_remove()},"id":widget.wid,}})},criteria_remove: function(){var element=jQuery(this.elements[0]);element.prop('checked',true);this.do_query()},count: function(sortcountable){var query=Faceted.SortedQuery();query.cid=this.wid;if(this.version){query.version=this.version}
var context=this;jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_START,{wid:context.wid});jQuery.getJSON(Faceted.BASEURL+'@@faceted_counter',query, function(data){context.count_update(data,sortcountable);jQuery(Faceted.Events).trigger(Faceted.Events.DO_UPDATE);jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_STOP,{wid:context.wid})})},count_update: function(data,sortcountable){var context=this;var lis=jQuery('li',context.widget);jQuery(lis).each(function(){var li=jQuery(this);li.removeClass('faceted-radio-item-disabled');li.removeClass('faceted-radio-item-zerocount');var input=jQuery('input',li);input.unbind();var key=input.val();var span=jQuery('span',li);if(!span.length){var label=jQuery('label',li);label.append(' ');label.append(jQuery('<span>'));span=jQuery('span',li)}
var value=data[key];value=value?value:0;span.text('('+value+')');if(sortcountable){li.data('count',value)}
if(!value){li.addClass('faceted-radio-item-disabled');if(context.widget.hasClass('faceted-zero-count-hidden')){li.addClass('faceted-radio-item-zerocount')}
input.prop('disabled','disabled')}else{input.prop('disabled',false);input.click(function(evt){context.radio_click(this,evt)})}});if(sortcountable){lis.detach().sort(function(x,y){var a=jQuery(x).data('count');var b=jQuery(y).data('count');return b-a})}
jQuery('ul',context.widget).append(lis);context.fieldset.trigger('widget-refresh')}};Faceted.initializeRadioWidget=function(evt){jQuery('div.faceted-radio-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.RadioWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeRadioWidget)});

/* - ++resource++eea.facetednavigation.widgets.portlet.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.portlet.view.js?original=1
Faceted.PortletWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();jQuery('legend',this.widget).hide();jQuery('fieldset',this.widget).css('border','none');jQuery('form',this.widget).submit(function(){return true})};Faceted.initializePortletWidget=function(evt){jQuery('div.faceted-portlet-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];var widget=new Faceted.PortletWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializePortletWidget)});

/* - ++resource++eea.facetednavigation.widgets.path.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.path.view.js?original=1
Faceted.PathWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.input=jQuery('input',this.widget);this.breadcrumbs=jQuery('<dd>');this.selected=[];var value=this.input.val();if(value){this.selected=this.input;Faceted.Query[this.wid]=[value]}
var tree=new FacetedTree.JsTree(this.wid,this.widget);var js_widget=this;jQuery('form',this.widget).submit(function(){return false});jQuery(FacetedTree.Events).bind(FacetedTree.Events.CHANGED, function(data){js_widget.text_change(js_widget.input)});jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()})};Faceted.PathWidget.prototype={text_change: function(element,evt){this.do_query(element)},do_query: function(element){var value=this.input.val();value=value?[value]:[];if(!element){this.selected=[];return Faceted.Form.do_query(this.wid,[])}
this.selected=[this.input];return Faceted.Form.do_query(this.wid,value)},reset: function(){this.selected=[];this.widget.removeClass("faceted-widget-active");this.input.val('')},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset();return}
this.selected=[this.input];this.widget.addClass("faceted-widget-active")},criteria: function(){var html=[];var title=this.criteria_title();var body=this.criteria_body();if(title){html.push(title)}
if(body){html.push(body)}
return html},criteria_title: function(){if(!this.selected.length){return ''}
var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid);link.attr('title','Remove '+this.title+' filters');var widget=this;link.click(function(evt){widget.criteria_remove();return false});var html=jQuery('<dt>');html.attr('id','criteria_'+this.wid+'_label');html.append(link);html.append('<span>'+this.title+'</span>');return html},criteria_body: function(){if(!this.selected.length){return ''}
var js_widget=this;js_widget.breadcrumbs.text('Loading...');var query={};query.path=js_widget.input.val();query.cid=js_widget.wid;jQuery.getJSON(Faceted.BASEURL+'@@faceted.path.breadcrumbs.json',query, function(data){js_widget.breadcrumbs.empty();jQuery.each(data, function(){js_widget.breadcrumbs.append(jQuery('<span>').html('&raquo;'));var a=jQuery('<a>');a.attr('href',this.url);a.attr('title',this.title);a.text(this.title);a.click(function(){var path=jQuery(this).attr('href');js_widget.input.val(path);jQuery(FacetedTree.Events).trigger(FacetedTree.Events.CHANGED,{path:path});return false});js_widget.breadcrumbs.append(a)})});return js_widget.breadcrumbs},criteria_remove: function(){this.selected=[];this.input.val('');this.do_query()}};Faceted.initializePathWidget=function(evt){jQuery('div.faceted-path-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.PathWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializePathWidget)});

/* - ++resource++eea.facetednavigation.widgets.path.tree.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.path.tree.js?original=1
var FacetedTree={version:'2.0'};FacetedTree.Events={};FacetedTree.Events.CHANGED='FACETEDTREE-CHANGED';FacetedTree.Events.AJAX_START='FACETEDTREE-AJAX-START';FacetedTree.Events.AJAX_STOP='FACETEDTREE-AJAX-STOP';FacetedTree.JsTree=function(wid,container,mode){this.BASEURL='';if(window.FacetedEdit){this.BASEURL=FacetedEdit.BASEURL}else if(window.Faceted){this.BASEURL=Faceted.BASEURL}
this.wid=wid;this.mode=mode||'view';this.input=jQuery('#'+wid,container);this.input.attr('readonly','readonly');this.theme=jQuery('#'+wid+'-theme',container);this.area=jQuery('<div>');this.area.addClass('tree');this.area.text('Loading...');this.area.hide();this.area.width(this.input.width());this.input.after(this.area);var js_tree=this;this.input.click(function(evt){js_tree.show()});jQuery(document).click(function(e){var target=jQuery(e.target);if(target.is('#'+js_tree.input.attr('id'))){return}
var parent=target.parents('#'+js_tree.area.attr('id'));if(parent.length){return}
js_tree.hide()});jQuery(document).keydown(function(e){if(e.keyCode==27){js_tree.hide()}});var query={};query.cid=this.wid;query.mode=this.mode;jQuery(FacetedTree.Events).trigger(FacetedTree.Events.AJAX_START,{msg:'Loading ...'});jQuery.getJSON(js_tree.BASEURL+'@@faceted.path.tree.json',query, function(data){if(data.length){js_tree.initialize(data)}else{if(mode=='edit'){jQuery('form',container).hide();jQuery('div.faceted-path-errors',container).show()}else{jQuery('.faceted-widget:has(div.faceted-path-errors)').remove();jQuery(Faceted.Events).trigger(Faceted.Events.REDRAW)}}
jQuery(FacetedTree.Events).trigger(FacetedTree.Events.AJAX_STOP,{msg:data})})};FacetedTree.JsTree.prototype={initialize: function(static_tree){var js_tree=this;js_tree.area.jstree({ui:{theme_name:js_tree.theme.attr('title'),theme_path:js_tree.theme.text()},types:{"default":{clickable:true,renameable:false,deletable:false,creatable:false,draggable:false}},data:{type:'json',async:true,opts:{method:'POST',url:js_tree.BASEURL+'@@faceted.path.tree.json'}},callback:{beforedata: function(node,tree){if(node===false){tree.settings.data.opts['static']=static_tree;return}
tree.settings.data.opts['static']=false;var data={cid:js_tree.wid};data.mode=js_tree.mode;if(node){data.path=node.attr('path')}
return data},onselect: function(node,tree){js_tree.change(node,tree)}}})},show: function(){this.area.show()},hide: function(){this.area.hide()},change: function(node,tree){this.hide();node=jQuery(node);var value=node.attr('path');if(this.input.val()==value){value=''}
this.input.val(value);jQuery(FacetedTree.Events).trigger(FacetedTree.Events.CHANGED,{path:value})}};

/* - ++resource++eea.facetednavigation.widgets.multiselect.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.multiselect.view.js?original=1
Faceted.MultiSelectWidget=function(wid){var self=this;this.wid=wid;this.widget=jQuery('#'+this.wid+'_widget');this.widget.show();this.title=this.widget.find('legend').html();this.elements=this.widget.find('option');this.select=jQuery('#'+this.wid);this.multiple=this.select.attr("multiple")?true:false;this.placeholder=this.widget.data('placeholder');this.closeOnSelect=this.widget.data('closeonselect');this.selected=[];this.select.select2({placeholder:this.placeholder,closeOnSelect:this.closeOnSelect,allowClear:true});this.operatorElem=this.widget.find('.faceted-operator');this.operatorVisible=this.operatorElem.length?true:false;if(this.operatorVisible){this.operator=$("input[checked='checked']",this.operatorElem).val();$("input",this.operatorElem).change(function(evt){self.operator_change($(this),evt)})} else{this.operator=this.widget.data('operator')}
this.version='';var version=jQuery('#faceted-version');if(version){this.version=version.text()}
jQuery('form',this.widget).submit(function(){return false});this.select.on('change.select2', function(evt){self.select_change(this,evt)});var value=this.select.val();if(value){this.selected=self.widget.find('option:selected');if(this.multiple){Faceted.Query[this.wid]=value} else{Faceted.Query[this.wid]=[value]}}
if(this.operatorVisible){Faceted.Query[self.wid+'-operator']=self.operator}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){self.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){self.reset()});if(this.widget.hasClass('faceted-count')){var sortcountable=this.widget.hasClass('faceted-sortcountable');jQuery(Faceted.Events).bind(Faceted.Events.QUERY_INITIALIZED, function(evt){self.count(sortcountable)});jQuery(Faceted.Events).bind(Faceted.Events.FORM_DO_QUERY, function(evt,data){if(self.operator!='and'&&(data.wid==self.wid||data.wid=='b_start')){return}
self.count(sortcountable)})}};Faceted.MultiSelectWidget.prototype={select_change: function(element,evt){if(!jQuery(element).val()){element=null}
this.do_query(element)},operator_change: function($element,evt){var self=this;self.operator=$element.val();Faceted.Form.do_query(self.wid+'-operator',self.operator)},do_query: function(element){if(!element){this.selected=[];return Faceted.Form.do_query(this.wid,[])}else{var value=jQuery(element).val();this.selected=this.widget.find('option:selected');return Faceted.Form.do_query(this.wid,value)}},reset: function(){this.select.val(null).trigger("change.select2");this.selected=[];this.widget.removeClass("faceted-widget-active")},synchronize: function(){var value=Faceted.Query[this.wid];if(value){this.select.val(value).trigger("change.select2");this.selected=this.widget.find('option:selected');this.widget.addClass("faceted-widget-active")} else{this.reset()}
var operator=Faceted.Query[this.wid+'-operator'];if(this.operatorVisible&&operator){operator=operator[0];this.operator=operator;$("input[value='"+operator+"']",this.operatorElem).attr("checked","checked")}},criteria: function(){var widget=this;return widget.selected.map(function(element,index){var element=jQuery(this);return{"widget_title":widget.title,"option_title":element.text(),"handler":()=>{widget.criteria_remove()},"id":widget.wid,}})},criteria_remove: function(value,element){if(!value){this.select.val(null).trigger("change.select2");this.do_query()}else{element.attr('selected',false);this.select.trigger("change.select2");this.do_query(this.select)}},count: function(sortcountable){var query=Faceted.SortedQuery();query.cid=this.wid;if(this.version){query.version=this.version}
if(this.operator&&!query[this.wid+'-operator']){query[this.wid+'-operator']=this.operator}
var context=this;jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_START,{wid:context.wid});jQuery.getJSON(Faceted.BASEURL+'@@faceted_counter',query, function(data){context.count_update(data,sortcountable);jQuery(Faceted.Events).trigger(Faceted.Events.DO_UPDATE);jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_STOP,{wid:context.wid})})},count_update: function(data,sortcountable){var context=this;var select=jQuery('select',context.widget);var options=jQuery('option',context.widget);var current_val=select.val();jQuery(options).each(function(){var option=jQuery(this);if(!option.attr('title')){return}
option.removeClass('faceted-select-item-disabled');option.attr('disabled',false);var key=option.val();var value=data[key];value=value?value:0;var option_txt=option.attr('title');option_txt+=' ('+value+')';option.html(option_txt);if(sortcountable){option.data('count',value)}
if(!value){option.attr('disabled','disabled');option.addClass('faceted-select-item-disabled')}});if(sortcountable){options.detach().sort(function(x,y){var a=jQuery(x).data('count');var b=jQuery(y).data('count');return b-a});select.append(options);select.val(current_val)}}};Faceted.initializeMultiSelectWidget=function(evt){jQuery('div.faceted-multiselect-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.MultiSelectWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeMultiSelectWidget)});

/* - ++resource++eea.facetednavigation.widgets.debug.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.debug.view.js?original=1
Faceted.DebugWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.query_area=jQuery('dd.debug-query pre',this.widget);this.after_area=jQuery('dd.debug-after pre',this.widget);this.config_area=jQuery('dd.debug-config pre',this.widget);this.count_area=jQuery('dd.debug-count pre',this.widget);jQuery('dd',this.widget).hide();jQuery('dt',this.widget).each(function(){var dt=jQuery(this);var css=dt.attr('class');var parent=dt.parent('dl');var minmax=jQuery('<span>').addClass('ui-icon ui-icon-plus').css('float','left');minmax.click(function(){var button=jQuery(this);jQuery('dd.'+css,parent).toggle();if(button.hasClass('ui-icon-minus')){button.removeClass('ui-icon-minus');button.addClass('ui-icon-plus')}else{button.removeClass('ui-icon-plus');button.addClass('ui-icon-minus')}});dt.prepend(minmax)});var js_widget=this;jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()})};Faceted.DebugWidget.prototype={synchronize: function(){var context=this;var query=jQuery.extend({},Faceted.Query);query['debugger']=this.wid;jQuery.get(Faceted.BASEURL+'@@faceted.widget.debug.query',query, function(data){if(data=="[]"){jQuery('.debug-query',context.widget).hide()}else{jQuery('dt.debug-query',context.widget).show()}
context.query_area.text(data)});jQuery.get(Faceted.BASEURL+'@@faceted.widget.debug.after',query, function(data){if(data=="[]"){jQuery('.debug-after',context.widget).hide()}else{jQuery('dt.debug-after',context.widget).show()}
context.after_area.text(data)});jQuery.get(Faceted.BASEURL+'@@faceted.widget.debug.criteria',query, function(data){if(data=="[]"){jQuery('.debug-config',context.widget).hide()}else{jQuery('dt.debug-config',context.widget).show()}
context.config_area.text(data)});jQuery.get(Faceted.BASEURL+'@@faceted.widget.debug.counters',query, function(data){if(data=="[]"){jQuery('.debug-count',context.widget).hide()}else{jQuery('dt.debug-count',context.widget).show()}
context.count_area.text(data)})},criteria: function(){return []}};Faceted.initializeDebugWidget=function(evt){jQuery('div.faceted-debug-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.DebugWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeDebugWidget)});

/* - ++resource++eea.facetednavigation.widgets.daterange.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.daterange.view.js?original=1
Faceted.DateRangeWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.start=jQuery('input[name=start]',this.widget);this.yearRange=jQuery('input[name=calYearRange]',this.widget).val();this.end=jQuery('input[name=end]',this.widget);this.selected=[];this.usePloneFormat=jQuery('input[name=usePloneFormat]',this.widget).val();this.usePloneFormat=this.usePloneFormat=="True"?true:false;this.dateFormat=jQuery('input[name=dateFormat]',this.widget).val();this.language=jQuery('input[name=language]',this.widget).val()||'en';this.allowOpenDates=this.widget.data("allowOpenDates")===true;this.startLabel=jQuery("#"+this.wid+"_start label").html();this.endLabel=jQuery("#"+this.wid+"_end label").html();var start=this.start.val();var end=this.end.val();if((start&&end)||this.allowOpenDates){this.selected=[this.start,this.end];Faceted.Query[this.wid]=[start,end]}
var js_widget=this;this.start.datepicker({dateFormat:this.dateFormat,yearRange:this.yearRange,onSelect: function(date,cal){js_widget.force_start_range();js_widget.select_change(js_widget.start)}});this.end.datepicker({yearRange:this.yearRange,dateFormat:this.dateFormat,onSelect: function(date,cal){js_widget.force_end_range();js_widget.select_change(js_widget.end)}});if(start){js_widget.force_start_range()}
if(end){js_widget.force_end_range()}
this.start.change(function(){var start=js_widget.start.val();if(!start){js_widget.criteria_remove("start")} else{js_widget.select_change(this)}});this.end.change(function(){var end=js_widget.end.val();if(!end){js_widget.criteria_remove("end")} else{js_widget.select_change(this)}});jQuery('form',this.widget).submit(function(){return false});jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()})};Faceted.DateRangeErrorMsg={dateError:{en:'Please enter a date in the format MM/DD/YYYY.',de:'Bitte geben Sie ein Datum im Format TT.MM.JJJJ ein.'},rangeError:{en:'The start date must be before the end date.',de:'Das Startdatum muss vor dem Enddatum liegen.'}};Faceted.DateRangeWidget.prototype={select_change: function(element){this.do_query(element)},force_start_range: function(){var start_date=this.start.datepicker("getDate");if(start_date){this.end.datepicker("option","minDate",start_date)}},force_end_range: function(){var end_date=this.end.datepicker("getDate");if(end_date){this.start.datepicker("option","maxDate",end_date)}},stringToDate: function(dateString){if(this.usePloneFormat){try{date=dateString?jQuery.datepicker.parseDate(this.dateFormat,dateString):null} catch{date=null}} else{date=dateString?new Date(dateString.replace(/-/g,'/')):null}
return date},validate: function(){var start=this.start.val();var end=this.end.val();var start_date=this.stringToDate(start);var end_date=this.stringToDate(end);const errorChecks=[{evaluator:start&&!start_date,errorTextSelector:'_start_errors',errorClassSelectors:['_start_wrapper'],errorText:'dateError'},{evaluator:end&&!end_date,errorTextSelector:'_end_errors',errorClassSelectors:['_end_wrapper'],errorText:'dateError'},{evaluator:start_date&&end_date&&end_date<start_date,errorTextSelector:'_errors',errorClassSelectors:['_widget'],errorText:'rangeError'}];let error=false;errorChecks.forEach(check=>{const errorTextSelector=this.wid+check.errorTextSelector;const errorClassSelectors=check.errorClassSelectors.map(c=>this.wid+c);const errorText=Faceted.DateRangeErrorMsg[check.errorText][this.language];if(check.evaluator){error=true;Faceted.Form.raise_error(errorText,errorTextSelector,errorClassSelectors)}else{Faceted.Form.clear_errors(errorTextSelector,errorClassSelectors)}});return!error},do_query: function(element){var start=this.start.val();var end=this.end.val();if(!start&&!end){this.reset();Faceted.Form.do_query(this.wid,[]);return false}
if(!this.allowOpenDates&&(!start||!end)){this.selected=[];return false}
var value=[start,end];if(this.validate()){this.selected=[this.start,this.end];Faceted.Form.do_query(this.wid,value)}},reset: function(scope="all"){if(scope=="start"||scope=="all"){this.selected=this.selected.filter((elem)=>elem!=this.start);this.start.val('');this.end.datepicker("option","minDate",null)}
if(scope=="end"||scope=="all"){this.selected=this.selected.filter((elem)=>elem!=this.end);this.end.val('');this.start.datepicker("option","maxDate",null)}
if(!this.start.val()&&!this.end.val()){this.selected=[];this.widget.removeClass("faceted-widget-active")}
this.validate()},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset();return false}
if(!value.length||value.length<2){this.reset();return false}
var start=value[0];var end=value[1];var start_date=this.stringToDate(start);var end_date=this.stringToDate(end);if(start&&(!start_date||!start_date.getFullYear())){this.reset();return false}
if(end&&(!end_date||!end_date.getFullYear())){this.reset();return false}
this.start.val(start);this.end.val(end);this.selected=[this.start,this.end];this.widget.addClass("faceted-widget-active")},criteria: function(){var start=this.start.val();var end=this.end.val();var start_date=this.stringToDate(start);var end_date=this.stringToDate(end);criteria_data=[]
if(this.allowOpenDates){if(start_date){criteria_data.push({"widget_title":this.startLabel,"option_title":this.criteria_label([start_date]),"handler":()=>{this.criteria_remove("start")},"id":this.wid+"_start_date",})}
if(end_date){criteria_data.push({"widget_title":this.endLabel,"option_title":this.criteria_label([end_date]),"handler":()=>{this.criteria_remove("end")},"id":this.wid+"_end_date",})}} else{if(start_date&&end_date){criteria_data.push({"widget_title":this.title,"option_title":this.criteria_label([start_date,end_date]),"handler":()=>{this.criteria_remove()},"id":this.wid+"_dates",})}}
return criteria_data},criteria_label: function(dates){if(this.usePloneFormat){var options={weekday:"short",year:"numeric",month:"short",day:"numeric"};var dates_labels=dates.map((date)=>date?date.toLocaleDateString(this.language,options):"").filter((label)=>label!=="")} else{var dates_labels=dates.map((date)=>date?date.toDateString():"").filter((label)=>label!=="")}
return dates_labels.join(" - ")},criteria_remove: function(scope="all"){this.reset(scope);this.do_query();return false}};Faceted.initializeDateRangeWidget=function(evt){jQuery('div.faceted-daterange-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.DateRangeWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeDateRangeWidget)});

/* - ++resource++eea.facetednavigation.widgets.date.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.date.view.js?original=1
Faceted.DateWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.select_from=jQuery('select[name=from]',this.widget);this.select_to=jQuery('select[name=to]',this.widget);this.select_from.hide();this.select_to.hide();var js_widget=this;this.slider=jQuery('select',this.widget).selectToUISlider({labels:2,labelSrc:'text',sliderOptions:{change: function(){js_widget.change()}}});jQuery('span.ui-slider-label',this.widget).each(function(i){if(i!==11){return}
var span=jQuery(this);span.addClass('ui-slider-label-show')});this.selected=[];var from=this.select_from.val();var to=this.select_to.val();if((from!=='now-past')||(to!=='now_future')){this.selected=[this.select_from,this.select_to];Faceted.Query[this.wid]=[from,to]}
jQuery('form',this.widget).submit(function(){return false});jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset_ui()})};Faceted.DateWidget.prototype={change: function(){var from=this.select_from.val();var to=this.select_to.val();if(from==='now-past'&&to==='now_future'){this.reset();Faceted.Form.do_query(this.wid,[])}else{this.do_query()}},do_query: function(){var value=[this.select_from.val(),this.select_to.val()];this.selected=[this.select_from,this.select_to];Faceted.Form.do_query(this.wid,value)},reset: function(){this.selected=[];this.select_from.val('now-past');this.select_to.val('now_future');this.widget.removeClass("faceted-widget-active")},reset_ui: function(){this.reset();this.select_from.trigger('change');this.select_to.trigger('change')},synchronize: function(){var q_value=Faceted.Query[this.wid];if(!q_value){this.reset_ui();return}
if(!q_value.length){this.reset_ui();return}
if(q_value.length<2){this.reset_ui();return}
this.select_from.val(q_value[0]).trigger('change');this.select_to.val(q_value[1]).trigger('change');this.widget.addClass("faceted-widget-active")},criteria: function(){var html=[];var title=this.criteria_title();var body=this.criteria_body();if(title){html.push(title)}
if(body){html.push(body)}
return html},criteria_title: function(){if(!this.selected.length){return ''}
var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid);link.attr('title','Remove '+this.title+' filters');var widget=this;link.click(function(evt){widget.criteria_remove();return false});var html=jQuery('<dt>');html.attr('id','criteria_'+this.wid+'_label');html.append(link);html.append('<span>'+this.title+'</span>');return html},criteria_body: function(){if(!this.selected.length){return ''}
var from=jQuery('option:selected',this.select_from).text();var to=jQuery('option:selected',this.select_to).text();var label=from+' - '+to;var widget=this;var html=jQuery('<dd>');html.attr('id','criteria_'+this.wid+'_entries');var span=jQuery('<span class="faceted-date-criterion">');var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid+'_');link.attr('title','Remove '+label+' filter');link.click(function(evt){widget.criteria_remove();return false});span.append(link);jQuery('<span>').text(label).appendTo(span);html.append(span);return html},criteria_remove: function(){this.reset_ui();return Faceted.Form.do_query(this.wid,[])}};Faceted.initializeDateWidget=function(evt){jQuery('div.faceted-date-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.DateWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeDateWidget)});

/* - ++resource++eea.facetednavigation.widgets.criteria.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.criteria.view.js?original=1
Faceted.CriteriaWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.title=jQuery('legend',this.widget).html();this.area=jQuery('#'+wid);this.reset_button=jQuery('#'+wid+'_reset');this.no_options_chosen_text=jQuery('.no_options_chosen',this.widget);this.translations={'remove_option':{'en':'Remove option','de':'Entferne Option',}};var js_widget=this;this.reset_button.click(function(evt){js_widget.reset_click(this,evt);return false});jQuery(Faceted.Events).bind(Faceted.Events.AJAX_QUERY_START, function(evt){return js_widget.update()});jQuery(Faceted.Events).bind(Faceted.Events.DO_UPDATE, function(evt){return js_widget.update()})};Faceted.CriteriaWidget.prototype={reset_click: function(element,evt){jQuery(Faceted.Events).trigger(Faceted.Events.RESET);this.do_query()},do_query: function(wid,value){Faceted.Form.do_query(wid,value)},update: function(){var context=this;var empty=true;var lang=$("html").attr("lang");context.area.empty();jQuery.each(Faceted.Query, function(key){var widget=Faceted.Widgets[key];if(!widget){return}
var criteria=widget.criteria();jQuery.each(criteria, function(){var criterion=this;empty=false;if(criterion instanceof jQuery){console.log("DEPRECATED: The widget "+widget.title+" is not yet refactored. Falling back to old behavior.")
context.area.append(criterion)} else if(typeof(criterion)==="object"){var title=criterion.option_title?criterion.widget_title+': '+criterion.option_title:criterion.widget_title;var link=jQuery('<button class="button faceted-remove">'+title+'</button>').attr('id','criteria_'+criterion.id).attr('title',context.translations.remove_option[lang]).click(criterion.handler);var close_span=jQuery('<span class="close"/>');link.append(close_span);context.area.append(link)}})});if(!empty){context.reset_button.removeClass("disabled").attr("aria-disabled","false");context.no_options_chosen_text.hide()} else{context.reset_button.addClass("disabled").attr("aria-disabled","true");context.no_options_chosen_text.show()}},criteria: function(){return []},};Faceted.initializeCriteriaWidget=function(evt){jQuery('div.faceted-criteria-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.CriteriaWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeCriteriaWidget)});

/* - ++resource++eea.facetednavigation.widgets.checkbox.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.checkbox.view.js?original=1
Faceted.CheckboxesWidget=function(wid){var self=this;this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.fieldset=jQuery('.widget-fieldset',this.widget);this.title=jQuery('legend',this.widget).html();this.elements=jQuery('form input[type=checkbox]',this.widget);this.maxitems=parseInt(jQuery('span',this.widget).text(),10);this.operatorElem=this.widget.find('.faceted-operator a');this.operatorVisible=this.operatorElem.length?true:false;if(this.operatorVisible){this.operator=this.operatorElem.data('value');this.operatorElem.click(function(evt){evt.preventDefault();self.operator_click(this,evt)});this.operatorElem.text(this.operatorElem.data(this.operator))}else{this.operator=this.widget.data('operator')}
this.selected=[];this.version='';var version=jQuery('#faceted-version');if(version){this.version=version.text()}
jQuery('form',this.widget).submit(function(){return false});this.elements.click(function(evt){self.checkbox_click(this,evt)});var selected=this.widget.find('form input[type=checkbox]:checked');if(selected.length){this.selected=selected;Faceted.Query[this.wid]=[];selected.each(function(){Faceted.Query[self.wid].push(jQuery(this).val())})}
if(this.operatorVisible){Faceted.Query[self.wid+'-operator']=self.operator}
if(this.maxitems){this.fieldset.collapsible({maxitems:this.maxitems,elements:'li:not(.faceted-checkbox-item-zerocount)',more:this.widget.data("more"),less:this.widget.data("less")})}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){self.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){self.reset()});if(this.widget.hasClass('faceted-count')){var sortcountable=this.widget.hasClass('faceted-sortcountable');jQuery(Faceted.Events).bind(Faceted.Events.QUERY_INITIALIZED, function(evt){self.count(sortcountable)});jQuery(Faceted.Events).bind(Faceted.Events.FORM_DO_QUERY, function(evt,data){if(self.operator!='and'&&(data.wid==self.wid||data.wid=='b_start')){return}
self.count(sortcountable)})}};Faceted.CheckboxesWidget.prototype={checkbox_click: function(element,evt){this.do_query(element)},operator_click: function(element,evt){var self=this;if(self.operator==='or'){self.operator='and';self.operatorElem.text(self.operatorElem.data('and'))}else{self.operator='or';self.operatorElem.text(self.operatorElem.data('or'))}
Faceted.Form.do_query(this.wid+'-operator',self.operator)},operator_label: function(){if(!this.operatorVisible){return ''}
var label=this.widget.find('.faceted-operator label');label=label.length?label.text():'';label+=' '+this.operatorElem.data(this.operator);return '('+label+')'},do_query: function(element){this.selected=jQuery('form input[type=checkbox]:checked',this.widget);var value=[];this.selected.each(function(i){value.push(jQuery(this).val())});Faceted.Form.do_query(this.wid,value)},reset: function(){this.selected=[];this.widget.removeClass("faceted-widget-active");jQuery(this.elements).attr('checked',false)},synchronize: function(){this.elements.attr('checked',false);var checked=Faceted.Query[this.wid];if(checked){jQuery('form input[type=checkbox]',this.widget).val(checked);this.selected=jQuery('form input[type=checkbox]:checked',this.widget);this.widget.addClass("faceted-widget-active")}
var operator=Faceted.Query[this.wid+'-operator'];if(this.operatorVisible&&operator){operator=operator[0];this.operator=operator;this.operatorElem.data('value',operator);this.operatorElem.text(this.operatorElem.data(this.operator))}},criteria: function(){var widget=this;return widget.selected.map(function(element,index){var element=jQuery(this);var id=element.attr('id');var value=element.val();var label=jQuery('label[for='+id+']',widget.widget);var title=label.attr('title');label=label.text();return{"widget_title":widget.elements.length>1?widget.title:title,"option_title":widget.elements.length>1?title:'',"handler":()=>{widget.criteria_remove(value,element)},"id":id,}})},criteria_remove: function(value,element){if(!value){this.elements.attr('checked',false);this.do_query()}else{element.attr('checked',false);this.do_query()}},count: function(sortcountable){var query=Faceted.SortedQuery();query.cid=this.wid;if(this.version){query.version=this.version}
if(this.operator&&!query[this.wid+'-operator']){query[this.wid+'-operator']=this.operator}
var context=this;jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_START,{wid:context.wid});jQuery.getJSON(Faceted.BASEURL+'@@faceted_counter',query, function(data){context.count_update(data,sortcountable);jQuery(Faceted.Events).trigger(Faceted.Events.DO_UPDATE);jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_STOP,{wid:context.wid})})},count_update: function(data,sortcountable){var context=this;var lis=jQuery('li',context.widget);jQuery(lis).each(function(){var li=jQuery(this);li.removeClass('faceted-checkbox-item-disabled');li.removeClass('faceted-checkbox-item-zerocount');var input=jQuery('input',li);input.unbind();var key=input.val();var span=jQuery('span',li);if(!span.length){var label=jQuery('label',li);label.append(' ');label.append(jQuery('<span>'));span=jQuery('span',li)}
var value=data[key];value=value?value:0;span.text('('+data[key]+')');if(sortcountable){li.data('count',value)}
if(!value){li.addClass('faceted-checkbox-item-disabled');if(context.widget.hasClass('faceted-zero-count-hidden')){li.addClass('faceted-checkbox-item-zerocount')}
input.attr('disabled','disabled')}else{input.attr('disabled',false);input.click(function(evt){context.checkbox_click(this,evt)})}});if(sortcountable){lis.detach().sort(function(x,y){var a=jQuery(x).data('count');var b=jQuery(y).data('count');return b-a})}
jQuery('ul',context.widget).append(lis);context.fieldset.trigger('widget-refresh')}};Faceted.initializeCheckboxesWidget=function(evt){jQuery('div.faceted-checkboxes-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.CheckboxesWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeCheckboxesWidget)});

/* - ++resource++eea.facetednavigation.widgets.autocomplete.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.autocomplete.view.js?original=1
Faceted.AutocompleteWidget=function(wid){var self=this;this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.elements=this.widget.find('option');this.select=jQuery('#'+this.wid);this.multiple=this.widget.data("multiple")?true:false;this.placeholder=this.widget.data('placeholder');this.autocomplete_view=this.widget.data('autocomplete-view');this.selected=[];this.button=jQuery('input[type=submit]',this.widget);this.select.select2({placeholder:this.placeholder,multiple:this.multiple,allowClear:true,minimumInputLength:2,ajax:{url:this.autocomplete_view,delay:250,dataType:'json',params:{global:false},data: function(term,page){return{term:term,add_terms:true}},results: function(data,page){return{results:data}},cache:false}});jQuery('form',this.widget).submit(function(){return false});if(this.button.length){this.button.on('click', function(evt){self.text_change(self.button)})} else{this.select.on('select2-close', function(evt){self.select_change(this,evt)});this.select.on('select2-removed', function(evt){self.select_change(this,evt)})}
var value=this.select.select2('val');if(value){this.selected=[this.select];if(this.multiple){Faceted.Query[this.wid]=value} else{Faceted.Query[this.wid]=[value]}}
jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){self.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){self.reset()})};Faceted.AutocompleteWidget.prototype={select_change: function(element,evt){if(!jQuery(element).val()){element=null}
this.do_query(element)},text_change: function(element,evt){this.do_query(element);jQuery(element).removeClass("submitting")},do_query: function(element){var value=this.select.select2('val');if(value&&!Array.isArray(value)){value=[value]}
if(!element){this.selected=[];return Faceted.Form.do_query(this.wid,[])}
this.selected=[this.select];var where=jQuery('input[type=radio]:checked',this.widget);where=where.length==1?where.val():'all';if(where=='all'){return Faceted.Form.do_query(this.wid,value)}
var current=Faceted.Query[this.wid]||[];jQuery.each(value, function(idx,val){if(!current.includes(val)){current.push(val)}});return Faceted.Form.do_query(this.wid,current)},reset: function(){this.selected=[];this.widget.removeClass("faceted-widget-active");this.select.select2("val",null)},synchronize: function(){var self=this;var value=Faceted.Query[this.wid];if(!value){return this.reset()}
if(!Array.isArray(value)){value=[value]}
var data=[];jQuery.each(value, function(idx,val){var item={id:val,text:val};if(self.multiple){data.push(item)} else{data=item}});this.select.select2('data',data);this.selected=[this.select];this.widget.addClass("faceted-widget-active")},criteria: function(){var html=[];var title=this.criteria_title();var body=this.criteria_body();if(title){html.push(title)}
if(body){html.push(body)}
return html},criteria_title: function(){if(!this.selected.length){return ''}
var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid);link.attr('title','Remove '+this.title+' filters');var widget=this;link.click(function(evt){widget.criteria_remove();return false});var html=jQuery('<dt>');html.attr('id','criteria_'+this.wid+'_label');html.append(link);html.append('<span>'+this.title+'</span>');return html},criteria_body: function(){if(!this.selected.length){return ''}
var widget=this;var html=jQuery('<dd>');var elements=Faceted.Query[this.wid];elements=elements?elements:[];jQuery.each(elements, function(){var label=this.toString();if(label.length>0){var span=jQuery('<span class="faceted-autocomplete-criterion">');var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+widget.wid+'_'+label);link.attr('title','Remove '+label+' filter');link.click(function(){widget.criteria_remove(label);return false});span.append(link);jQuery('<span>').text(label).appendTo(span);html.append(span)}});return html},criteria_remove: function(value){if(!value){this.reset();return this.do_query()}
current=Faceted.Query[this.wid]||[];Faceted.Query[this.wid]=current.filter(function(item){return item!=value});this.synchronize();this.do_query(this.select)}};Faceted.initializeAutocompleteWidget=function(evt){jQuery('div.faceted-autocomplete-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.AutocompleteWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeAutocompleteWidget)});

/* - ++resource++eea.facetednavigation.widgets.alphabets.view.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.facetednavigation.widgets.alphabets.view.js?original=1
Faceted.AlphabeticalWidget=function(wid){this.wid=wid;this.widget=jQuery('#'+wid+'_widget');this.widget.show();this.title=jQuery('legend',this.widget).html();this.letters=jQuery('#'+wid+' span');this.selected=[];this.version='';var version=jQuery('#faceted-version');if(version){this.version=version.text()}
var selected=jQuery('.faceted_letter_selected');if(selected.length){Faceted.Query[this.wid]=[selected.attr('id').split('-')[1]];this.synchronize()}
var js_widget=this;this.letters.click(function(evt){js_widget.letter_click(this,evt)});jQuery(Faceted.Events).bind(Faceted.Events.QUERY_CHANGED, function(evt){js_widget.synchronize()});jQuery(Faceted.Events).bind(Faceted.Events.RESET, function(evt){js_widget.reset()});if(this.widget.hasClass('faceted-count')){var sortcountable=this.widget.hasClass('faceted-sortcountable');jQuery(Faceted.Events).bind(Faceted.Events.QUERY_INITIALIZED, function(evt){js_widget.count(sortcountable)});jQuery(Faceted.Events).bind(Faceted.Events.FORM_DO_QUERY, function(evt,data){if(data.wid==js_widget.wid||data.wid=='b_start'){return}
js_widget.count(sortcountable)})}};Faceted.AlphabeticalWidget.prototype={letter_click: function(letter,evt){this.do_query(letter)},letter_unselect: function(letter){jQuery(letter).removeClass('faceted_letter_selected');this.widget.removeClass("faceted-widget-active");this.selected=[]},letter_select: function(letter){this.letter_unselect(this.letters);jQuery(letter).addClass('faceted_letter_selected');if(jQuery(letter).attr('id').split('-')[1]!='all'){this.widget.addClass("faceted-widget-active");this.selected=[letter]}},do_query: function(letter){var value=jQuery(letter).attr('id').split('-')[1];var selected_value='';if(this.selected.length){selected_value=jQuery(this.selected[0]).attr('id').split('-')[1]}
if(value==selected_value){this.letter_select(jQuery('#'+this.wid+'-all'),this.widget);value=[]}else{this.letter_select(letter)}
Faceted.Form.do_query(this.wid,value)},reset: function(){this.letter_select(jQuery('#'+this.wid+'-all',this.widget))},synchronize: function(){var value=Faceted.Query[this.wid];if(!value){this.reset()}else{var letter=jQuery('#'+this.wid+'-'+value[0]);if(letter.length){this.letter_select(letter[0])}else{this.reset()}}},criteria: function(){var html=[];var title=this.criteria_title();var body=this.criteria_body();if(title){html.push(title)}
if(body){html.push(body)}
return html},criteria_title: function(){if(!this.selected.length){return ''}
var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid);link.attr('title','Remove '+this.title+' filters');var widget=this;link.click(function(evt){widget.criteria_remove(this,evt);return false});var html=jQuery('<dt>');html.attr('id','criteria_'+this.wid+'_label');html.append(link);html.append('<span>'+this.title+'</span>');return html},criteria_body: function(){if(!this.selected.length){return ''}
var label=jQuery(this.selected[0]).attr('id').split('-')[1];var link=jQuery('<a href="#" class="faceted-remove">remove</a>');link.attr('id','criteria_'+this.wid+'_'+label);link.attr('title','Remove '+label+' filter');var widget=this;link.click(function(evt){widget.criteria_remove(this,evt);return false});var html=jQuery('<dd>');html.attr('id','criteria_'+this.wid+'_entries');var span=jQuery('<span class="faceted-alphabetic-criterion">');span.append(link);jQuery('<span>').text(label).appendTo(span);html.append(span);return html},criteria_remove: function(element,evt){this.do_query(this.selected[0])},count: function(sortcountable){var query=Faceted.SortedQuery();query.cid=this.wid;if(this.version){query.version=this.version}
var context=this;jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_START,{wid:context.wid});jQuery.getJSON(Faceted.BASEURL+'@@faceted_counter',query, function(data){context.count_update(data,sortcountable);jQuery(Faceted.Events).trigger(Faceted.Events.DO_UPDATE);jQuery(Faceted.Events).trigger(Faceted.Events.AJAX_STOP,{wid:context.wid})})},count_update: function(data,sortcountable){var context=this;context.letters.each(function(){var letter=jQuery(this);letter.removeClass('faceted-alphabetic-letter-disabled');letter.unbind();var key=letter.attr('id').split('-')[1];var value=data[key];value=value?value:0;letter.attr('title',value);if(sortcountable){letter.data('count',value)}
if(!value){letter.addClass('faceted-alphabetic-letter-disabled')}else{letter.click(function(evt){context.letter_click(this,evt)})}});if(sortcountable){context.letters.detach().sort(function(x,y){var a=jQuery(x).data('count');var b=jQuery(y).data('count');return b-a})}
jQuery('#'+context.wid,context.widget).append(context.letters)}};Faceted.initializeAlphabeticalWidget=function(evt){jQuery('div.faceted-alphabetic-widget').each(function(){var wid=jQuery(this).attr('id');wid=wid.split('_')[0];Faceted.Widgets[wid]=new Faceted.AlphabeticalWidget(wid)})};jQuery(document).ready(function(){jQuery(Faceted.Events).bind(Faceted.Events.INITIALIZE,Faceted.initializeAlphabeticalWidget)});

/* - ++resource++eea.faceted-navigation-independent.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.faceted-navigation-independent.js?original=1
jQuery(document).ready(function(){jQuery('form.faceted-external-search').submit(function(evt){evt.preventDefault();var form=jQuery(this);var action=form.attr('action');var query=form.serialize();window.location.href=action+'#'+query})});

/* - ++resource++eea.faceted-navigation-expand.js - */
// https://tu-dresden.de/portal_javascripts/++resource++eea.faceted-navigation-expand.js?original=1
(function(jQuery){jQuery.fn.collapsible=function(settings){var self=this;self.colapsed=false;var options={maxitems:0,elements:'li',more:'More',less:'Less',events:{refresh:'widget-refresh',expand:'widget-expand',colapse:'widget-colapse'},handle_refresh: function(evt,data){jQuery(options.elements,self).show();self.button.hide();if(!options.maxitems){return}
var elements=jQuery(options.elements,self);if(elements.length<options.maxitems){return}
if(self.colapsed){jQuery('a',self.button).text(options.more)}else{jQuery('a',self.button).text(options.less)}
self.button.show();if(!self.colapsed){return}
elements.each(function(index){if(index<options.maxitems){jQuery(this).show()}else{jQuery(this).hide()}})},handle_expand: function(evt,data){self.colapsed=false;self.trigger(options.events.refresh)},handle_colapse: function(evt,data){self.colapsed=true;self.trigger(options.events.refresh)},initialize: function(){self.bind(options.events.refresh, function(evt,data){options.handle_refresh(evt,data)});self.bind(options.events.expand, function(evt,data){options.handle_expand(evt,data)});self.bind(options.events.colapse, function(evt,data){options.handle_colapse(evt,data)});var link=jQuery('<a>').attr('href','#').text('More');self.button=jQuery('<div>').addClass('faceted-checkbox-more').append(link).hide();self.append(self.button);link.click(function(){if(self.colapsed){self.trigger(options.events.expand)}else{self.trigger(options.events.colapse)}
return false});if(options.maxitems){link.click()}}};if(settings){jQuery.extend(options,settings)}
options.initialize();return this}})(jQuery);
